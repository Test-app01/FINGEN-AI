(()=>{var e={};e.id=276,e.ids=[276],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},20492:e=>{"use strict";let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function s(e,s,o){null==o&&null!==s&&"object"==typeof s&&(o=s,s=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let i=JSON.parse(e,s);if(null===i||"object"!=typeof i)return i;let l=o&&o.protoAction||"error",u=o&&o.constructorAction||"error";if("ignore"===l&&"ignore"===u)return i;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return i}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return i}else if(!1===a.test(e))return i;return n(i,{protoAction:l,constructorAction:u,safe:o&&o.safe})}function n(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let s=[e];for(;s.length;){let e=s;for(let n of(s=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(n,"__proto__")){if(!0===a)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete n.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete n.constructor}for(let e in n){let t=n[e];t&&"object"==typeof t&&s.push(t)}}}return e}function o(e,t,r){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=o,e.exports.default=o,e.exports.parse=o,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=n},25887:(e,t,r)=>{"use strict";let a,s;r.r(t),r.d(t,{patchFetch:()=>oY,routeModule:()=>oJ,serverHooks:()=>oH,workAsyncStorage:()=>oK,workUnitAsyncStorage:()=>oW});var n,o,i,l,u,c,d,p,m,h,f,g,y,v,_,b,w,x,k,T,S,I,E,j,A,C,N,O,R,P,M,$,Z,D,q={};r.r(q),r.d(q,{POST:()=>oz,maxDuration:()=>oB});var F=r(96559),L=r(48088),U=r(37719),V="vercel.ai.error",B=Symbol.for(V),z=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[n]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,V)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};n=B;var J=z,K="AI_APICallError",W=`vercel.ai.error.${K}`,H=Symbol.for(W),Y=class extends J{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:s,responseBody:n,cause:i,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:K,message:e,cause:i}),this[o]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=s,this.responseBody=n,this.isRetryable=l,this.data=u}static isInstance(e){return J.hasMarker(e,W)}};o=H;var G="AI_EmptyResponseBodyError",X=`vercel.ai.error.${G}`,Q=Symbol.for(X),ee=class extends J{constructor({message:e="Empty response body"}={}){super({name:G,message:e}),this[i]=!0}static isInstance(e){return J.hasMarker(e,X)}};function et(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}i=Q;var er="AI_InvalidArgumentError",ea=`vercel.ai.error.${er}`,es=Symbol.for(ea),en=class extends J{constructor({message:e,cause:t,argument:r}){super({name:er,message:e,cause:t}),this[l]=!0,this.argument=r}static isInstance(e){return J.hasMarker(e,ea)}};l=es;var eo="AI_InvalidPromptError",ei=`vercel.ai.error.${eo}`,el=Symbol.for(ei),eu=class extends J{constructor({prompt:e,message:t,cause:r}){super({name:eo,message:`Invalid prompt: ${t}`,cause:r}),this[u]=!0,this.prompt=e}static isInstance(e){return J.hasMarker(e,ei)}};u=el;var ec="AI_InvalidResponseDataError",ed=`vercel.ai.error.${ec}`,ep=Symbol.for(ed),em=class extends J{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:ec,message:t}),this[c]=!0,this.data=e}static isInstance(e){return J.hasMarker(e,ed)}};c=ep;var eh="AI_JSONParseError",ef=`vercel.ai.error.${eh}`,eg=Symbol.for(ef),ey=class extends J{constructor({text:e,cause:t}){super({name:eh,message:`JSON parsing failed: Text: ${e}.
Error message: ${et(t)}`,cause:t}),this[d]=!0,this.text=e}static isInstance(e){return J.hasMarker(e,ef)}};d=eg;var ev="AI_LoadAPIKeyError",e_=`vercel.ai.error.${ev}`,eb=Symbol.for(e_),ew=class extends J{constructor({message:e}){super({name:ev,message:e}),this[p]=!0}static isInstance(e){return J.hasMarker(e,e_)}};p=eb;var ex=Symbol.for("vercel.ai.error.AI_LoadSettingError"),ek=Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),eT="AI_NoSuchModelError",eS=`vercel.ai.error.${eT}`,eI=Symbol.for(eS),eE=class extends J{constructor({errorName:e=eT,modelId:t,modelType:r,message:a=`No such ${r}: ${t}`}){super({name:e,message:a}),this[m]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return J.hasMarker(e,eS)}};m=eI;var ej="AI_TooManyEmbeddingValuesForCallError",eA=`vercel.ai.error.${ej}`,eC=Symbol.for(eA),eN=class extends J{constructor(e){super({name:ej,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[h]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return J.hasMarker(e,eA)}};h=eC;var eO="AI_TypeValidationError",eR=`vercel.ai.error.${eO}`,eP=Symbol.for(eR),eM=class e extends J{constructor({value:e,cause:t}){super({name:eO,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${et(t)}`,cause:t}),this[f]=!0,this.value=e}static isInstance(e){return J.hasMarker(e,eR)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};f=eP;var e$="AI_UnsupportedFunctionalityError",eZ=`vercel.ai.error.${e$}`,eD=Symbol.for(eZ),eq=class extends J{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:e$,message:t}),this[g]=!0,this.functionality=e}static isInstance(e){return J.hasMarker(e,eZ)}};function eF(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(eF):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eF(t)))}g=eD;let eL=(e,t=21)=>(r=t)=>{let a="",s=0|r;for(;s--;)a+=e[Math.random()*e.length|0];return a};var eU=r(20492),eV=Object.defineProperty,eB=(e,t,r)=>t in e?eV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ez=(e,t,r)=>eB(e,"symbol"!=typeof t?t+"":t,r);class eJ extends Error{constructor(e,t){super(e),ez(this,"type"),ez(this,"field"),ez(this,"value"),ez(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function eK(e){}class eW extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let a;super({start(s){a=function(e){let{onEvent:t=eK,onError:r=eK,onRetry:a=eK,onComment:s}=e,n="",o=!0,i,l="",u="";function c(e){if(""===e){l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u="";return}if(e.startsWith(":")){s&&s(e.slice(e.startsWith(": ")?2:1));return}let r=e.indexOf(":");if(-1!==r){let t=e.slice(0,r),a=" "===e[r+1]?2:1;d(t,e.slice(r+a),e);return}d(e,"",e)}function d(e,t,s){switch(e){case"event":u=t;break;case"data":l=`${l}${t}
`;break;case"id":i=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?a(parseInt(t,10)):r(new eJ(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:s}));break;default:r(new eJ(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:s}))}}return{feed:function(e){let t=o?e.replace(/^\xEF\xBB\xBF/,""):e,[r,a]=function(e){let t=[],r="",a=e.length;for(let s=0;s<a;s++){let a=e[s];"\r"===a&&e[s+1]===`
`?(t.push(r),r="",s++):"\r"===a||a===`
`?(t.push(r),r=""):r+=a}return[t,r]}(`${n}${t}`);for(let e of r)c(e);n=a,o=!1},reset:function(e={}){n&&e.consume&&c(n),i=void 0,l="",u="",n=""}}}({onEvent:e=>{s.enqueue(e)},onError(t){"terminate"===e?s.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){a.feed(e)}})}}function eH(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}async function eY(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}function eG(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var eX=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let s=eL(r,t);if(null==e)return s;if(r.includes(a))throw new en({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${s(t)}`},eQ=eX();function e0(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var e1=Symbol.for("vercel.ai.validator");function e9({value:e,schema:t}){var r;let a="object"==typeof t&&null!==t&&e1 in t&&!0===t[e1]&&"validate"in t?t:(r=t,{[e1]:!0,validate:e=>{let t=r.safeParse(e);return t.success?{success:!0,value:t.data}:{success:!1,error:t.error}}});try{if(null==a.validate)return{success:!0,value:e};let t=a.validate(e);if(t.success)return t;return{success:!1,error:eM.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:eM.wrap({value:e,cause:t})}}}function e4({text:e,schema:t}){try{let r=eU.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};let a=e9({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:ey.isInstance(t)?t:new ey({text:e,cause:t})}}}function e2(e){try{return eU.parse(e),!0}catch(e){return!1}}var e3=()=>globalThis.fetch,e6=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:o})=>e5({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:o}),e5=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:s,abortSignal:n,fetch:o=e3()})=>{try{var i;let l=await o(e,{method:"POST",headers:(i=t,Object.fromEntries(Object.entries(i).filter(([e,t])=>null!=t))),body:r.content,signal:n}),u=eG(l);if(!l.ok){let t;try{t=await s({response:l,url:e,requestBodyValues:r.values})}catch(t){if(e0(t)||Y.isInstance(t))throw t;throw new Y({message:"Failed to process error response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:r.values})}throw t.value}try{return await a({response:l,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(e0(t)||Y.isInstance(t)))throw t;throw new Y({message:"Failed to process successful response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:r.values})}}catch(t){if(e0(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let a=t.cause;if(null!=a)throw new Y({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},e7=e=>async({response:t})=>{let r=eG(t);if(null==t.body)throw new ee({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new eW).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(e4({text:t,schema:e}))}}))}},e8=e=>async({response:t,url:r,requestBodyValues:a})=>{let s=await t.text(),n=e4({text:s,schema:e}),o=eG(t);if(!n.success)throw new Y({message:"Invalid JSON response",cause:n.error,statusCode:t.status,responseHeaders:o,responseBody:s,url:r,requestBodyValues:a});return{responseHeaders:o,value:n.value,rawValue:n.rawValue}},{btoa:te,atob:tt}=globalThis;function tr(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return te(t)}(function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(y||(y={})),(v||(v={})).mergeShapes=(e,t)=>({...e,...t});let ta=y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ts=e=>{switch(typeof e){case"undefined":return ta.undefined;case"string":return ta.string;case"number":return isNaN(e)?ta.nan:ta.number;case"boolean":return ta.boolean;case"function":return ta.function;case"bigint":return ta.bigint;case"symbol":return ta.symbol;case"object":if(Array.isArray(e))return ta.array;if(null===e)return ta.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return ta.promise;if("undefined"!=typeof Map&&e instanceof Map)return ta.map;if("undefined"!=typeof Set&&e instanceof Set)return ta.set;if("undefined"!=typeof Date&&e instanceof Date)return ta.date;return ta.object;default:return ta.unknown}},tn=y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class to extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(a);else if("invalid_return_type"===s.code)a(s.returnTypeError);else if("invalid_arguments"===s.code)a(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,a=0;for(;a<s.path.length;){let r=s.path[a];a===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof to))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,y.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}to.create=e=>new to(e);let ti=(e,t)=>{let r;switch(e.code){case tn.invalid_type:r=e.received===ta.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case tn.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,y.jsonStringifyReplacer)}`;break;case tn.unrecognized_keys:r=`Unrecognized key(s) in object: ${y.joinValues(e.keys,", ")}`;break;case tn.invalid_union:r="Invalid input";break;case tn.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${y.joinValues(e.options)}`;break;case tn.invalid_enum_value:r=`Invalid enum value. Expected ${y.joinValues(e.options)}, received '${e.received}'`;break;case tn.invalid_arguments:r="Invalid function arguments";break;case tn.invalid_return_type:r="Invalid function return type";break;case tn.invalid_date:r="Invalid date";break;case tn.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:y.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case tn.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case tn.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case tn.custom:r="Invalid input";break;case tn.invalid_intersection_types:r="Intersection results could not be merged";break;case tn.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case tn.not_finite:r="Number must be finite";break;default:r=t.defaultError,y.assertNever(e)}return{message:r}},tl=ti;function tu(){return tl}let tc=e=>{let{data:t,path:r,errorMaps:a,issueData:s}=e,n=[...r,...s.path||[]],o={...s,path:n};if(void 0!==s.message)return{...s,path:n,message:s.message};let i="";for(let e of a.filter(e=>!!e).slice().reverse())i=e(o,{data:t,defaultError:i}).message;return{...s,path:n,message:i}};function td(e,t){let r=tu(),a=tc({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===ti?void 0:ti].filter(e=>!!e)});e.common.issues.push(a)}class tp{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return tm;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return tp.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:s}=a;if("aborted"===t.status||"aborted"===s.status)return tm;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==s.value||a.alwaysSet)&&(r[t.value]=s.value)}return{status:e.value,value:r}}}let tm=Object.freeze({status:"aborted"}),th=e=>({status:"dirty",value:e}),tf=e=>({status:"valid",value:e}),tg=e=>"aborted"===e.status,ty=e=>"dirty"===e.status,tv=e=>"valid"===e.status,t_=e=>"undefined"!=typeof Promise&&e instanceof Promise;function tb(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function tw(e,t,r,a,s){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(e,r):s?s.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(_||(_={}));class tx{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let tk=(e,t)=>{if(tv(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new to(e.common.issues);return this._error=t,this._error}}};function tT(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:s}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(t,s)=>{var n,o;let{message:i}=e;return"invalid_enum_value"===t.code?{message:null!=i?i:s.defaultError}:void 0===s.data?{message:null!==(n=null!=i?i:a)&&void 0!==n?n:s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:null!==(o=null!=i?i:r)&&void 0!==o?o:s.defaultError}},description:s}}class tS{get description(){return this._def.description}_getType(e){return ts(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ts(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new tp,ctx:{common:e.parent.common,data:e.data,parsedType:ts(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(t_(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ts(e)},s=this._parseSync({data:e,path:a.path,parent:a});return tk(a,s)}"~validate"(e){var t,r;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ts(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:a});return tv(t)?{value:t.value}:{issues:a.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(e=>tv(e)?{value:e.value}:{issues:a.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ts(e)},a=this._parse({data:e,path:r.path,parent:r});return tk(r,await (t_(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let s=e(t),n=()=>a.addIssue({code:tn.custom,...r(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(n(),!1)):!!s||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new ru({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return rc.create(this,this._def)}nullable(){return rd.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return t9.create(this)}promise(){return rl.create(this,this._def)}or(e){return t2.create([this,e],this._def)}and(e){return t5.create(this,e,this._def)}transform(e){return new ru({...tT(this._def),schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new rp({...tT(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:x.ZodDefault})}brand(){return new rg({typeName:x.ZodBranded,type:this,...tT(this._def)})}catch(e){return new rm({...tT(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:x.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ry.create(this,e)}readonly(){return rv.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let tI=/^c[^\s-]{8,}$/i,tE=/^[0-9a-z]+$/,tj=/^[0-9A-HJKMNP-TV-Z]{26}$/i,tA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tC=/^[a-z0-9_-]{21}$/i,tN=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tO=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tR=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,tM=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,t$=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,tZ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tD=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,tq=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,tF="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tL=RegExp(`^${tF}$`);function tU(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function tV(e){let t=`${tF}T${tU(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class tB extends tS{_parse(e){var t,r,s,n;let o;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ta.string){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.string,received:t.parsedType}),tm}let i=new tp;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(td(o=this._getOrReturnCtx(e,o),{code:tn.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if("max"===l.kind)e.data.length>l.value&&(td(o=this._getOrReturnCtx(e,o),{code:tn.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(o=this._getOrReturnCtx(e,o),t?td(o,{code:tn.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&td(o,{code:tn.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),i.dirty())}else if("email"===l.kind)tR.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"email",code:tn.invalid_string,message:l.message}),i.dirty());else if("emoji"===l.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"emoji",code:tn.invalid_string,message:l.message}),i.dirty());else if("uuid"===l.kind)tA.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"uuid",code:tn.invalid_string,message:l.message}),i.dirty());else if("nanoid"===l.kind)tC.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"nanoid",code:tn.invalid_string,message:l.message}),i.dirty());else if("cuid"===l.kind)tI.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"cuid",code:tn.invalid_string,message:l.message}),i.dirty());else if("cuid2"===l.kind)tE.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"cuid2",code:tn.invalid_string,message:l.message}),i.dirty());else if("ulid"===l.kind)tj.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"ulid",code:tn.invalid_string,message:l.message}),i.dirty());else if("url"===l.kind)try{new URL(e.data)}catch(t){td(o=this._getOrReturnCtx(e,o),{validation:"url",code:tn.invalid_string,message:l.message}),i.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"regex",code:tn.invalid_string,message:l.message}),i.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(td(o=this._getOrReturnCtx(e,o),{code:tn.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),i.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(td(o=this._getOrReturnCtx(e,o),{code:tn.invalid_string,validation:{startsWith:l.value},message:l.message}),i.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(td(o=this._getOrReturnCtx(e,o),{code:tn.invalid_string,validation:{endsWith:l.value},message:l.message}),i.dirty()):"datetime"===l.kind?tV(l).test(e.data)||(td(o=this._getOrReturnCtx(e,o),{code:tn.invalid_string,validation:"datetime",message:l.message}),i.dirty()):"date"===l.kind?tL.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{code:tn.invalid_string,validation:"date",message:l.message}),i.dirty()):"time"===l.kind?RegExp(`^${tU(l)}$`).test(e.data)||(td(o=this._getOrReturnCtx(e,o),{code:tn.invalid_string,validation:"time",message:l.message}),i.dirty()):"duration"===l.kind?tO.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"duration",code:tn.invalid_string,message:l.message}),i.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(r=l.version)||!r)&&tP.test(t)||("v6"===r||!r)&&t$.test(t))&&(td(o=this._getOrReturnCtx(e,o),{validation:"ip",code:tn.invalid_string,message:l.message}),i.dirty())):"jwt"===l.kind?!function(e,t){if(!tN.test(e))return!1;try{let[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(a));if("object"!=typeof s||null===s||!s.typ||!s.alg||t&&s.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,l.alg)&&(td(o=this._getOrReturnCtx(e,o),{validation:"jwt",code:tn.invalid_string,message:l.message}),i.dirty()):"cidr"===l.kind?(s=e.data,!(("v4"===(n=l.version)||!n)&&tM.test(s)||("v6"===n||!n)&&tZ.test(s))&&(td(o=this._getOrReturnCtx(e,o),{validation:"cidr",code:tn.invalid_string,message:l.message}),i.dirty())):"base64"===l.kind?tD.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"base64",code:tn.invalid_string,message:l.message}),i.dirty()):"base64url"===l.kind?tq.test(e.data)||(td(o=this._getOrReturnCtx(e,o),{validation:"base64url",code:tn.invalid_string,message:l.message}),i.dirty()):y.assertNever(l);return{status:i.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:tn.invalid_string,..._.errToObj(r)})}_addCheck(e){return new tB({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,..._.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,..._.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,..._.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new tB({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tB({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tB({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tB.create=e=>{var t;return new tB({checks:[],typeName:x.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...tT(e)})};class tz extends tS{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ta.number){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.number,received:t.parsedType}),tm}let r=new tp;for(let a of this._def.checks)"int"===a.kind?y.isInteger(e.data)||(td(t=this._getOrReturnCtx(e,t),{code:tn.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(td(t=this._getOrReturnCtx(e,t),{code:tn.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(td(t=this._getOrReturnCtx(e,t),{code:tn.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,s=r>a?r:a;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}(e.data,a.value)&&(td(t=this._getOrReturnCtx(e,t),{code:tn.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(td(t=this._getOrReturnCtx(e,t),{code:tn.not_finite,message:a.message}),r.dirty()):y.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,r,a){return new tz({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:_.toString(a)}]})}_addCheck(e){return new tz({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&y.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}tz.create=e=>new tz({checks:[],typeName:x.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...tT(e)});class tJ extends tS{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==ta.bigint)return this._getInvalidInput(e);let r=new tp;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(td(t=this._getOrReturnCtx(e,t),{code:tn.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(td(t=this._getOrReturnCtx(e,t),{code:tn.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(td(t=this._getOrReturnCtx(e,t),{code:tn.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):y.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.bigint,received:t.parsedType}),tm}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,r,a){return new tJ({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:_.toString(a)}]})}_addCheck(e){return new tJ({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tJ.create=e=>{var t;return new tJ({checks:[],typeName:x.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...tT(e)})};class tK extends tS{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ta.boolean){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.boolean,received:t.parsedType}),tm}return tf(e.data)}}tK.create=e=>new tK({typeName:x.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...tT(e)});class tW extends tS{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ta.date){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.date,received:t.parsedType}),tm}if(isNaN(e.data.getTime()))return td(this._getOrReturnCtx(e),{code:tn.invalid_date}),tm;let r=new tp;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(td(t=this._getOrReturnCtx(e,t),{code:tn.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(td(t=this._getOrReturnCtx(e,t),{code:tn.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):y.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new tW({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}tW.create=e=>new tW({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:x.ZodDate,...tT(e)});class tH extends tS{_parse(e){if(this._getType(e)!==ta.symbol){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.symbol,received:t.parsedType}),tm}return tf(e.data)}}tH.create=e=>new tH({typeName:x.ZodSymbol,...tT(e)});class tY extends tS{_parse(e){if(this._getType(e)!==ta.undefined){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.undefined,received:t.parsedType}),tm}return tf(e.data)}}tY.create=e=>new tY({typeName:x.ZodUndefined,...tT(e)});class tG extends tS{_parse(e){if(this._getType(e)!==ta.null){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.null,received:t.parsedType}),tm}return tf(e.data)}}tG.create=e=>new tG({typeName:x.ZodNull,...tT(e)});class tX extends tS{constructor(){super(...arguments),this._any=!0}_parse(e){return tf(e.data)}}tX.create=e=>new tX({typeName:x.ZodAny,...tT(e)});class tQ extends tS{constructor(){super(...arguments),this._unknown=!0}_parse(e){return tf(e.data)}}tQ.create=e=>new tQ({typeName:x.ZodUnknown,...tT(e)});class t0 extends tS{_parse(e){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.never,received:t.parsedType}),tm}}t0.create=e=>new t0({typeName:x.ZodNever,...tT(e)});class t1 extends tS{_parse(e){if(this._getType(e)!==ta.undefined){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.void,received:t.parsedType}),tm}return tf(e.data)}}t1.create=e=>new t1({typeName:x.ZodVoid,...tT(e)});class t9 extends tS{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==ta.array)return td(t,{code:tn.invalid_type,expected:ta.array,received:t.parsedType}),tm;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,s=t.data.length<a.exactLength.value;(e||s)&&(td(t,{code:e?tn.too_big:tn.too_small,minimum:s?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(td(t,{code:tn.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(td(t,{code:tn.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new tx(t,e,t.path,r)))).then(e=>tp.mergeArray(r,e));let s=[...t.data].map((e,r)=>a.type._parseSync(new tx(t,e,t.path,r)));return tp.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new t9({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new t9({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new t9({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}}t9.create=(e,t)=>new t9({type:e,minLength:null,maxLength:null,exactLength:null,typeName:x.ZodArray,...tT(t)});class t4 extends tS{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=y.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ta.object){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.object,received:t.parsedType}),tm}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),n=[];if(!(this._def.catchall instanceof t0&&"strip"===this._def.unknownKeys))for(let e in r.data)s.includes(e)||n.push(e);let o=[];for(let e of s){let t=a[e],s=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new tx(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof t0){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of n)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)n.length>0&&(td(r,{code:tn.unrecognized_keys,keys:n}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of n){let a=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new tx(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>tp.mergeObjectSync(t,e)):tp.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new t4({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,s,n,o;let i=null!==(n=null===(s=(a=this._def).errorMap)||void 0===s?void 0:s.call(a,t,r).message)&&void 0!==n?n:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=_.errToObj(e).message)&&void 0!==o?o:i}:{message:i}}}:{}})}strip(){return new t4({...this._def,unknownKeys:"strip"})}passthrough(){return new t4({...this._def,unknownKeys:"passthrough"})}extend(e){return new t4({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t4({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:x.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new t4({...this._def,catchall:e})}pick(e){let t={};return y.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new t4({...this._def,shape:()=>t})}omit(e){let t={};return y.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new t4({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof t4){let r={};for(let a in t.shape){let s=t.shape[a];r[a]=rc.create(e(s))}return new t4({...t._def,shape:()=>r})}if(t instanceof t9)return new t9({...t._def,type:e(t.element)});if(t instanceof rc)return rc.create(e(t.unwrap()));if(t instanceof rd)return rd.create(e(t.unwrap()));if(t instanceof t7)return t7.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};return y.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new t4({...this._def,shape:()=>t})}required(e){let t={};return y.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof rc;)e=e._def.innerType;t[r]=e}}),new t4({...this._def,shape:()=>t})}keyof(){return rn(y.objectKeys(this.shape))}}t4.create=(e,t)=>new t4({shape:()=>e,unknownKeys:"strip",catchall:t0.create(),typeName:x.ZodObject,...tT(t)}),t4.strictCreate=(e,t)=>new t4({shape:()=>e,unknownKeys:"strict",catchall:t0.create(),typeName:x.ZodObject,...tT(t)}),t4.lazycreate=(e,t)=>new t4({shape:e,unknownKeys:"strip",catchall:t0.create(),typeName:x.ZodObject,...tT(t)});class t2 extends tS{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new to(e.ctx.common.issues));return td(t,{code:tn.invalid_union,unionErrors:r}),tm});{let e;let a=[];for(let s of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=s._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let s=a.map(e=>new to(e));return td(t,{code:tn.invalid_union,unionErrors:s}),tm}}get options(){return this._def.options}}t2.create=(e,t)=>new t2({options:e,typeName:x.ZodUnion,...tT(t)});let t3=e=>{if(e instanceof ra)return t3(e.schema);if(e instanceof ru)return t3(e.innerType());if(e instanceof rs)return[e.value];if(e instanceof ro)return e.options;if(e instanceof ri)return y.objectValues(e.enum);else if(e instanceof rp)return t3(e._def.innerType);else if(e instanceof tY)return[void 0];else if(e instanceof tG)return[null];else if(e instanceof rc)return[void 0,...t3(e.unwrap())];else if(e instanceof rd)return[null,...t3(e.unwrap())];else if(e instanceof rg)return t3(e.unwrap());else if(e instanceof rv)return t3(e.unwrap());else if(e instanceof rm)return t3(e._def.innerType);else return[]};class t6 extends tS{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ta.object)return td(t,{code:tn.invalid_type,expected:ta.object,received:t.parsedType}),tm;let r=this.discriminator,a=t.data[r],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(td(t,{code:tn.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),tm)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=t3(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of t){if(a.has(s))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,r)}}return new t6({typeName:x.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...tT(r)})}}class t5 extends tS{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(tg(e)||tg(a))return tm;let s=function e(t,r){let a=ts(t),s=ts(r);if(t===r)return{valid:!0,data:t};if(a===ta.object&&s===ta.object){let a=y.objectKeys(r),s=y.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of s){let s=e(t[a],r[a]);if(!s.valid)return{valid:!1};n[a]=s.data}return{valid:!0,data:n}}if(a===ta.array&&s===ta.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let s=0;s<t.length;s++){let n=e(t[s],r[s]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}if(a===ta.date&&s===ta.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,a.value);return s.valid?((ty(e)||ty(a))&&t.dirty(),{status:t.value,value:s.data}):(td(r,{code:tn.invalid_intersection_types}),tm)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t5.create=(e,t,r)=>new t5({left:e,right:t,typeName:x.ZodIntersection,...tT(r)});class t7 extends tS{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ta.array)return td(r,{code:tn.invalid_type,expected:ta.array,received:r.parsedType}),tm;if(r.data.length<this._def.items.length)return td(r,{code:tn.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),tm;!this._def.rest&&r.data.length>this._def.items.length&&(td(r,{code:tn.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new tx(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>tp.mergeArray(t,e)):tp.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new t7({...this._def,rest:e})}}t7.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new t7({items:e,typeName:x.ZodTuple,rest:null,...tT(t)})};class t8 extends tS{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ta.object)return td(r,{code:tn.invalid_type,expected:ta.object,received:r.parsedType}),tm;let a=[],s=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:s._parse(new tx(r,e,r.path,e)),value:n._parse(new tx(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?tp.mergeObjectAsync(t,a):tp.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new t8(t instanceof tS?{keyType:e,valueType:t,typeName:x.ZodRecord,...tT(r)}:{keyType:tB.create(),valueType:e,typeName:x.ZodRecord,...tT(t)})}}class re extends tS{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ta.map)return td(r,{code:tn.invalid_type,expected:ta.map,received:r.parsedType}),tm;let a=this._def.keyType,s=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new tx(r,e,r.path,[n,"key"])),value:s._parse(new tx(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,s=await r.value;if("aborted"===a.status||"aborted"===s.status)return tm;("dirty"===a.status||"dirty"===s.status)&&t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,s=r.value;if("aborted"===a.status||"aborted"===s.status)return tm;("dirty"===a.status||"dirty"===s.status)&&t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}}}}re.create=(e,t,r)=>new re({valueType:t,keyType:e,typeName:x.ZodMap,...tT(r)});class rt extends tS{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ta.set)return td(r,{code:tn.invalid_type,expected:ta.set,received:r.parsedType}),tm;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(td(r,{code:tn.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(td(r,{code:tn.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return tm;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let o=[...r.data.values()].map((e,t)=>s._parse(new tx(r,e,r.path,t)));return r.common.async?Promise.all(o).then(e=>n(e)):n(o)}min(e,t){return new rt({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new rt({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}rt.create=(e,t)=>new rt({valueType:e,minSize:null,maxSize:null,typeName:x.ZodSet,...tT(t)});class rr extends tS{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ta.function)return td(t,{code:tn.invalid_type,expected:ta.function,received:t.parsedType}),tm;function r(e,r){return tc({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,tu(),ti].filter(e=>!!e),issueData:{code:tn.invalid_arguments,argumentsError:r}})}function a(e,r){return tc({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,tu(),ti].filter(e=>!!e),issueData:{code:tn.invalid_return_type,returnTypeError:r}})}let s={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof rl){let e=this;return tf(async function(...t){let o=new to([]),i=await e._def.args.parseAsync(t,s).catch(e=>{throw o.addIssue(r(t,e)),o}),l=await Reflect.apply(n,this,i);return await e._def.returns._def.type.parseAsync(l,s).catch(e=>{throw o.addIssue(a(l,e)),o})})}{let e=this;return tf(function(...t){let o=e._def.args.safeParse(t,s);if(!o.success)throw new to([r(t,o.error)]);let i=Reflect.apply(n,this,o.data),l=e._def.returns.safeParse(i,s);if(!l.success)throw new to([a(i,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new rr({...this._def,args:t7.create(e).rest(tQ.create())})}returns(e){return new rr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new rr({args:e||t7.create([]).rest(tQ.create()),returns:t||tQ.create(),typeName:x.ZodFunction,...tT(r)})}}class ra extends tS{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ra.create=(e,t)=>new ra({getter:e,typeName:x.ZodLazy,...tT(t)});class rs extends tS{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return td(t,{received:t.data,code:tn.invalid_literal,expected:this._def.value}),tm}return{status:"valid",value:e.data}}get value(){return this._def.value}}function rn(e,t){return new ro({values:e,typeName:x.ZodEnum,...tT(t)})}rs.create=(e,t)=>new rs({value:e,typeName:x.ZodLiteral,...tT(t)});class ro extends tS{constructor(){super(...arguments),b.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return td(t,{expected:y.joinValues(r),received:t.parsedType,code:tn.invalid_type}),tm}if(tb(this,b,"f")||tw(this,b,new Set(this._def.values),"f"),!tb(this,b,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return td(t,{received:t.data,code:tn.invalid_enum_value,options:r}),tm}return tf(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ro.create(e,{...this._def,...t})}exclude(e,t=this._def){return ro.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}b=new WeakMap,ro.create=rn;class ri extends tS{constructor(){super(...arguments),w.set(this,void 0)}_parse(e){let t=y.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ta.string&&r.parsedType!==ta.number){let e=y.objectValues(t);return td(r,{expected:y.joinValues(e),received:r.parsedType,code:tn.invalid_type}),tm}if(tb(this,w,"f")||tw(this,w,new Set(y.getValidEnumValues(this._def.values)),"f"),!tb(this,w,"f").has(e.data)){let e=y.objectValues(t);return td(r,{received:r.data,code:tn.invalid_enum_value,options:e}),tm}return tf(e.data)}get enum(){return this._def.values}}w=new WeakMap,ri.create=(e,t)=>new ri({values:e,typeName:x.ZodNativeEnum,...tT(t)});class rl extends tS{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==ta.promise&&!1===t.common.async?(td(t,{code:tn.invalid_type,expected:ta.promise,received:t.parsedType}),tm):tf((t.parsedType===ta.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}rl.create=(e,t)=>new rl({type:e,typeName:x.ZodPromise,...tT(t)});class ru extends tS{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===x.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:e=>{td(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===a.type){let e=a.transform(r.data,s);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return tm;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?tm:"dirty"===a.status||"dirty"===t.value?th(a.value):a});{if("aborted"===t.value)return tm;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?tm:"dirty"===a.status||"dirty"===t.value?th(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?tm:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?tm:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>tv(e)?Promise.resolve(a.transform(e.value,s)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!tv(e))return e;let n=a.transform(e.value,s);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}}y.assertNever(a)}}ru.create=(e,t,r)=>new ru({schema:e,typeName:x.ZodEffects,effect:t,...tT(r)}),ru.createWithPreprocess=(e,t,r)=>new ru({schema:t,effect:{type:"preprocess",transform:e},typeName:x.ZodEffects,...tT(r)});class rc extends tS{_parse(e){return this._getType(e)===ta.undefined?tf(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rc.create=(e,t)=>new rc({innerType:e,typeName:x.ZodOptional,...tT(t)});class rd extends tS{_parse(e){return this._getType(e)===ta.null?tf(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rd.create=(e,t)=>new rd({innerType:e,typeName:x.ZodNullable,...tT(t)});class rp extends tS{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===ta.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}rp.create=(e,t)=>new rp({innerType:e,typeName:x.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...tT(t)});class rm extends tS{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return t_(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new to(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new to(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}rm.create=(e,t)=>new rm({innerType:e,typeName:x.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...tT(t)});class rh extends tS{_parse(e){if(this._getType(e)!==ta.nan){let t=this._getOrReturnCtx(e);return td(t,{code:tn.invalid_type,expected:ta.nan,received:t.parsedType}),tm}return{status:"valid",value:e.data}}}rh.create=e=>new rh({typeName:x.ZodNaN,...tT(e)});let rf=Symbol("zod_brand");class rg extends tS{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class ry extends tS{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?tm:"dirty"===e.status?(t.dirty(),th(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?tm:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ry({in:e,out:t,typeName:x.ZodPipeline})}}class rv extends tS{_parse(e){let t=this._def.innerType._parse(e),r=e=>(tv(e)&&(e.value=Object.freeze(e.value)),e);return t_(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function r_(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function rb(e,t={},r){return e?tX.create().superRefine((a,s)=>{var n,o;let i=e(a);if(i instanceof Promise)return i.then(e=>{var n,o;if(!e){let e=r_(t,a),i=null===(o=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===o||o;s.addIssue({code:"custom",...e,fatal:i})}});if(!i){let e=r_(t,a),i=null===(o=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===o||o;s.addIssue({code:"custom",...e,fatal:i})}}):tX.create()}rv.create=(e,t)=>new rv({innerType:e,typeName:x.ZodReadonly,...tT(t)});let rw={object:t4.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(x||(x={}));let rx=tB.create,rk=tz.create,rT=rh.create,rS=tJ.create,rI=tK.create,rE=tW.create,rj=tH.create,rA=tY.create,rC=tG.create,rN=tX.create,rO=tQ.create,rR=t0.create,rP=t1.create,rM=t9.create,r$=t4.create,rZ=t4.strictCreate,rD=t2.create,rq=t6.create,rF=t5.create,rL=t7.create,rU=t8.create,rV=re.create,rB=rt.create,rz=rr.create,rJ=ra.create,rK=rs.create,rW=ro.create,rH=ri.create,rY=rl.create,rG=ru.create,rX=rc.create,rQ=rd.create,r0=ru.createWithPreprocess,r1=ry.create;var r9=Object.freeze({__proto__:null,defaultErrorMap:ti,setErrorMap:function(e){tl=e},getErrorMap:tu,makeIssue:tc,EMPTY_PATH:[],addIssueToContext:td,ParseStatus:tp,INVALID:tm,DIRTY:th,OK:tf,isAborted:tg,isDirty:ty,isValid:tv,isAsync:t_,get util(){return y},get objectUtil(){return v},ZodParsedType:ta,getParsedType:ts,ZodType:tS,datetimeRegex:tV,ZodString:tB,ZodNumber:tz,ZodBigInt:tJ,ZodBoolean:tK,ZodDate:tW,ZodSymbol:tH,ZodUndefined:tY,ZodNull:tG,ZodAny:tX,ZodUnknown:tQ,ZodNever:t0,ZodVoid:t1,ZodArray:t9,ZodObject:t4,ZodUnion:t2,ZodDiscriminatedUnion:t6,ZodIntersection:t5,ZodTuple:t7,ZodRecord:t8,ZodMap:re,ZodSet:rt,ZodFunction:rr,ZodLazy:ra,ZodLiteral:rs,ZodEnum:ro,ZodNativeEnum:ri,ZodPromise:rl,ZodEffects:ru,ZodTransformer:ru,ZodOptional:rc,ZodNullable:rd,ZodDefault:rp,ZodCatch:rm,ZodNaN:rh,BRAND:rf,ZodBranded:rg,ZodPipeline:ry,ZodReadonly:rv,custom:rb,Schema:tS,ZodSchema:tS,late:rw,get ZodFirstPartyTypeKind(){return x},coerce:{string:e=>tB.create({...e,coerce:!0}),number:e=>tz.create({...e,coerce:!0}),boolean:e=>tK.create({...e,coerce:!0}),bigint:e=>tJ.create({...e,coerce:!0}),date:e=>tW.create({...e,coerce:!0})},any:rN,array:rM,bigint:rS,boolean:rI,date:rE,discriminatedUnion:rq,effect:rG,enum:rW,function:rz,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>rb(t=>t instanceof e,t),intersection:rF,lazy:rJ,literal:rK,map:rV,nan:rT,nativeEnum:rH,never:rR,null:rC,nullable:rQ,number:rk,object:r$,oboolean:()=>rI().optional(),onumber:()=>rk().optional(),optional:rX,ostring:()=>rx().optional(),pipeline:r1,preprocess:r0,promise:rY,record:rU,set:rB,strictObject:rZ,string:rx,symbol:rj,transformer:rG,tuple:rL,undefined:rA,union:rD,unknown:rO,void:rP,NEVER:tm,ZodIssueCode:tn,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:to});function r4(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:r})=>({token:e,logprob:t,topLogprobs:r?r.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?r:void 0}function r2(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var r3=r9.object({error:r9.object({message:r9.string(),type:r9.string().nullish(),param:r9.any().nullish(),code:r9.union([r9.string(),r9.number()]).nullish()})}),r6=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:s,requestBodyValues:n})=>{let o=await a.text(),i=eG(a);if(""===o.trim())return{responseHeaders:i,value:new Y({message:a.statusText,url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:i,responseBody:o,isRetryable:null==r?void 0:r(a)})};try{let l=function({text:e,schema:t}){try{let r=eU.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=e9({value:e,schema:t});if(!r.success)throw eM.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(ey.isInstance(t)||eM.isInstance(t))throw t;throw new ey({text:e,cause:t})}}({text:o,schema:e});return{responseHeaders:i,value:new Y({message:t(l),url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:i,responseBody:o,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:i,value:new Y({message:a.statusText,url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:i,responseBody:o,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:r3,errorToMessage:e=>e.error.message});function r5({id:e,model:t,created:r}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=r?new Date(1e3*r):void 0}}var r7=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return null!=(e=this.settings.structuredOutputs)?e:ar(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:s,topK:n,frequencyPenalty:o,presencePenalty:i,stopSequences:l,responseFormat:u,seed:c,providerMetadata:d}){var p,m,h,f,g,y,v,_,b,w,x;let k=e.type,T=[];null!=n&&T.push({type:"unsupported-setting",setting:"topK"}),(null==u?void 0:u.type)!=="json"||null==u.schema||this.supportsStructuredOutputs||T.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let S=this.settings.useLegacyFunctionCalling;if(S&&!0===this.settings.parallelToolCalls)throw new eq({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(S&&this.supportsStructuredOutputs)throw new eq({functionality:"structuredOutputs with useLegacyFunctionCalling"});let{messages:I,warnings:E}=function({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:r="system"}){let a=[],s=[];for(let{role:n,content:o}of e)switch(n){case"system":switch(r){case"system":a.push({role:"system",content:o});break;case"developer":a.push({role:"developer",content:o});break;case"remove":s.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${r}`)}break;case"user":if(1===o.length&&"text"===o[0].type){a.push({role:"user",content:o[0].text});break}a.push({role:"user",content:o.map(e=>{var t,r,a;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${tr(e.image)}`,detail:null==(a=null==(r=e.providerMetadata)?void 0:r.openai)?void 0:a.imageDetail}};case"file":if(e.data instanceof URL)throw new eq({functionality:"'File content parts with URL data' functionality not supported."});switch(e.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:e.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:e.data,format:"mp3"}};default:throw new eq({functionality:`File content part type ${e.mimeType} in user messages`})}}})});break;case"assistant":{let e="",r=[];for(let t of o)switch(t.type){case"text":e+=t.text;break;case"redacted-reasoning":case"reasoning":break;case"tool-call":r.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}});break;default:throw Error(`Unsupported part: ${t}`)}if(t){if(r.length>1)throw new eq({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});a.push({role:"assistant",content:e,function_call:r.length>0?r[0].function:void 0})}else a.push({role:"assistant",content:e,tool_calls:r.length>0?r:void 0});break}case"tool":for(let e of o)t?a.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):a.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${n}`)}return{messages:a,warnings:s}}({prompt:t,useLegacyFunctionCalling:S,systemMessageMode:ar(b=this.modelId)?null!=(x=null==(w=aa[b])?void 0:w.systemMessageMode)?x:"developer":"system"});T.push(...E);let j={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:a,top_p:s,frequency_penalty:o,presence_penalty:i,response_format:(null==u?void 0:u.type)==="json"?this.supportsStructuredOutputs&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,strict:!0,name:null!=(p=u.name)?p:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:c,max_completion_tokens:null==(m=null==d?void 0:d.openai)?void 0:m.maxCompletionTokens,store:null==(h=null==d?void 0:d.openai)?void 0:h.store,metadata:null==(f=null==d?void 0:d.openai)?void 0:f.metadata,prediction:null==(g=null==d?void 0:d.openai)?void 0:g.prediction,reasoning_effort:null!=(v=null==(y=null==d?void 0:d.openai)?void 0:y.reasoningEffort)?v:this.settings.reasoningEffort,messages:I};switch(ar(this.modelId)&&(null!=j.temperature&&(j.temperature=void 0,T.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=j.top_p&&(j.top_p=void 0,T.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=j.frequency_penalty&&(j.frequency_penalty=void 0,T.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=j.presence_penalty&&(j.presence_penalty=void 0,T.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=j.logit_bias&&(j.logit_bias=void 0,T.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=j.logprobs&&(j.logprobs=void 0,T.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=j.top_logprobs&&(j.top_logprobs=void 0,T.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=j.max_tokens&&(null==j.max_completion_tokens&&(j.max_completion_tokens=j.max_tokens),j.max_tokens=void 0)),k){case"regular":{let{tools:t,tool_choice:r,functions:a,function_call:s,toolWarnings:n}=function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r}){var a;let s=(null==(a=e.tools)?void 0:a.length)?e.tools:void 0,n=[];if(null==s)return{tools:void 0,tool_choice:void 0,toolWarnings:n};let o=e.toolChoice;if(t){let e=[];for(let t of s)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):e.push({name:t.name,description:t.description,parameters:t.parameters});if(null==o)return{functions:e,function_call:void 0,toolWarnings:n};switch(o.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0,toolWarnings:n};case"required":throw new eq({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:o.toolName},toolWarnings:n}}}let i=[];for(let e of s)"provider-defined"===e.type?n.push({type:"unsupported-tool",tool:e}):i.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters,strict:!!r||void 0}});if(null==o)return{tools:i,tool_choice:void 0,toolWarnings:n};let l=o.type;switch(l){case"auto":case"none":case"required":return{tools:i,tool_choice:l,toolWarnings:n};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:n};default:throw new eq({functionality:`Unsupported tool choice type: ${l}`})}}({mode:e,useLegacyFunctionCalling:S,structuredOutputs:this.supportsStructuredOutputs});return{args:{...j,tools:t,tool_choice:r,functions:a,function_call:s},warnings:[...T,...n]}}case"object-json":return{args:{...j,response_format:this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(_=e.name)?_:"response",description:e.description}}:{type:"json_object"}},warnings:T};case"object-tool":return{args:S?{...j,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...j,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:T};default:throw Error(`Unsupported type: ${k}`)}}async doGenerate(e){var t,r,a,s,n,o,i,l;let{args:u,warnings:c}=this.getArgs(e),{responseHeaders:d,value:p,rawValue:m}=await e6({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:eH(this.config.headers(),e.headers),body:u,failedResponseHandler:r6,successfulResponseHandler:e8(ae),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:h,...f}=u,g=p.choices[0],y=null==(t=p.usage)?void 0:t.completion_tokens_details,v=null==(r=p.usage)?void 0:r.prompt_tokens_details,_={openai:{}};return(null==y?void 0:y.reasoning_tokens)!=null&&(_.openai.reasoningTokens=null==y?void 0:y.reasoning_tokens),(null==y?void 0:y.accepted_prediction_tokens)!=null&&(_.openai.acceptedPredictionTokens=null==y?void 0:y.accepted_prediction_tokens),(null==y?void 0:y.rejected_prediction_tokens)!=null&&(_.openai.rejectedPredictionTokens=null==y?void 0:y.rejected_prediction_tokens),(null==v?void 0:v.cached_tokens)!=null&&(_.openai.cachedPromptTokens=null==v?void 0:v.cached_tokens),{text:null!=(a=g.message.content)?a:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&g.message.function_call?[{toolCallType:"function",toolCallId:eQ(),toolName:g.message.function_call.name,args:g.message.function_call.arguments}]:null==(s=g.message.tool_calls)?void 0:s.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:eQ(),toolName:e.function.name,args:e.function.arguments}}),finishReason:r2(g.finish_reason),usage:{promptTokens:null!=(o=null==(n=p.usage)?void 0:n.prompt_tokens)?o:NaN,completionTokens:null!=(l=null==(i=p.usage)?void 0:i.completion_tokens)?l:NaN},rawCall:{rawPrompt:h,rawSettings:f},rawResponse:{headers:d,body:m},request:{body:JSON.stringify(u)},response:r5(p),warnings:c,logprobs:r4(g.logprobs),providerMetadata:_}}async doStream(e){let t;if(this.settings.simulateStreaming){let t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(let r of t.toolCalls)e.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.toolCallId,toolName:r.toolName,argsTextDelta:r.args}),e.enqueue({type:"tool-call",...r});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}let{args:r,warnings:a}=this.getArgs(e),s={...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:n,value:o}=await e6({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:eH(this.config.headers(),e.headers),body:s,failedResponseHandler:r6,successfulResponseHandler:e7(at),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...l}=r,u=[],c="unknown",d={promptTokens:void 0,completionTokens:void 0},p=!0,{useLegacyFunctionCalling:m}=this.settings,h={openai:{}};return{stream:o.pipeThrough(new TransformStream({transform(e,r){var a,s,n,o,i,l,f,g,y,v,_,b;if(!e.success){c="error",r.enqueue({type:"error",error:e.error});return}let w=e.value;if("error"in w){c="error",r.enqueue({type:"error",error:w.error});return}if(p&&(p=!1,r.enqueue({type:"response-metadata",...r5(w)})),null!=w.usage){let{prompt_tokens:e,completion_tokens:t,prompt_tokens_details:r,completion_tokens_details:a}=w.usage;d={promptTokens:null!=e?e:void 0,completionTokens:null!=t?t:void 0},(null==a?void 0:a.reasoning_tokens)!=null&&(h.openai.reasoningTokens=null==a?void 0:a.reasoning_tokens),(null==a?void 0:a.accepted_prediction_tokens)!=null&&(h.openai.acceptedPredictionTokens=null==a?void 0:a.accepted_prediction_tokens),(null==a?void 0:a.rejected_prediction_tokens)!=null&&(h.openai.rejectedPredictionTokens=null==a?void 0:a.rejected_prediction_tokens),(null==r?void 0:r.cached_tokens)!=null&&(h.openai.cachedPromptTokens=null==r?void 0:r.cached_tokens)}let x=w.choices[0];if((null==x?void 0:x.finish_reason)!=null&&(c=r2(x.finish_reason)),(null==x?void 0:x.delta)==null)return;let k=x.delta;null!=k.content&&r.enqueue({type:"text-delta",textDelta:k.content});let T=r4(null==x?void 0:x.logprobs);(null==T?void 0:T.length)&&(void 0===t&&(t=[]),t.push(...T));let S=m&&null!=k.function_call?[{type:"function",id:eQ(),function:k.function_call,index:0}]:k.tool_calls;if(null!=S)for(let e of S){let t=e.index;if(null==u[t]){if("function"!==e.type)throw new em({data:e,message:"Expected 'function' type."});if(null==e.id)throw new em({data:e,message:"Expected 'id' to be a string."});if((null==(a=e.function)?void 0:a.name)==null)throw new em({data:e,message:"Expected 'function.name' to be a string."});u[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(s=e.function.arguments)?s:""},hasFinished:!1};let l=u[t];(null==(n=l.function)?void 0:n.name)!=null&&(null==(o=l.function)?void 0:o.arguments)!=null&&(l.function.arguments.length>0&&r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:l.id,toolName:l.function.name,argsTextDelta:l.function.arguments}),e2(l.function.arguments)&&(r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(i=l.id)?i:eQ(),toolName:l.function.name,args:l.function.arguments}),l.hasFinished=!0));continue}let c=u[t];!c.hasFinished&&((null==(l=e.function)?void 0:l.arguments)!=null&&(c.function.arguments+=null!=(g=null==(f=e.function)?void 0:f.arguments)?g:""),r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:c.id,toolName:c.function.name,argsTextDelta:null!=(y=e.function.arguments)?y:""}),(null==(v=c.function)?void 0:v.name)!=null&&(null==(_=c.function)?void 0:_.arguments)!=null&&e2(c.function.arguments)&&(r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(b=c.id)?b:eQ(),toolName:c.function.name,args:c.function.arguments}),c.hasFinished=!0))}},flush(e){var r,a;e.enqueue({type:"finish",finishReason:c,logprobs:t,usage:{promptTokens:null!=(r=d.promptTokens)?r:NaN,completionTokens:null!=(a=d.completionTokens)?a:NaN},...null!=h?{providerMetadata:h}:{}})}})),rawCall:{rawPrompt:i,rawSettings:l},rawResponse:{headers:n},request:{body:JSON.stringify(s)},warnings:a}}},r8=r9.object({prompt_tokens:r9.number().nullish(),completion_tokens:r9.number().nullish(),prompt_tokens_details:r9.object({cached_tokens:r9.number().nullish()}).nullish(),completion_tokens_details:r9.object({reasoning_tokens:r9.number().nullish(),accepted_prediction_tokens:r9.number().nullish(),rejected_prediction_tokens:r9.number().nullish()}).nullish()}).nullish(),ae=r9.object({id:r9.string().nullish(),created:r9.number().nullish(),model:r9.string().nullish(),choices:r9.array(r9.object({message:r9.object({role:r9.literal("assistant").nullish(),content:r9.string().nullish(),function_call:r9.object({arguments:r9.string(),name:r9.string()}).nullish(),tool_calls:r9.array(r9.object({id:r9.string().nullish(),type:r9.literal("function"),function:r9.object({name:r9.string(),arguments:r9.string()})})).nullish()}),index:r9.number(),logprobs:r9.object({content:r9.array(r9.object({token:r9.string(),logprob:r9.number(),top_logprobs:r9.array(r9.object({token:r9.string(),logprob:r9.number()}))})).nullable()}).nullish(),finish_reason:r9.string().nullish()})),usage:r8}),at=r9.union([r9.object({id:r9.string().nullish(),created:r9.number().nullish(),model:r9.string().nullish(),choices:r9.array(r9.object({delta:r9.object({role:r9.enum(["assistant"]).nullish(),content:r9.string().nullish(),function_call:r9.object({name:r9.string().optional(),arguments:r9.string().optional()}).nullish(),tool_calls:r9.array(r9.object({index:r9.number(),id:r9.string().nullish(),type:r9.literal("function").optional(),function:r9.object({name:r9.string().nullish(),arguments:r9.string().nullish()})})).nullish()}).nullish(),logprobs:r9.object({content:r9.array(r9.object({token:r9.string(),logprob:r9.number(),top_logprobs:r9.array(r9.object({token:r9.string(),logprob:r9.number()}))})).nullable()}).nullish(),finish_reason:r9.string().nullable().optional(),index:r9.number()})),usage:r8}),r3]);function ar(e){return"o1"===e||e.startsWith("o1-")||"o3"===e||e.startsWith("o3-")}var aa={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"}};function as(e){return null==e?void 0:e.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([e,t])=>({token:e,logprob:t})):[]}))}var an=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:a,temperature:s,topP:n,topK:o,frequencyPenalty:i,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d}){var p;let m=e.type,h=[];null!=o&&h.push({type:"unsupported-setting",setting:"topK"}),null!=c&&"text"!==c.type&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:f,stopSequences:g}=function({prompt:e,inputFormat:t,user:r="user",assistant:a="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let s="";for(let{role:t,content:n}of("system"===e[0].role&&(s+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new eu({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=n.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new eq({functionality:"images"})}}).join("");s+=`${r}:
${e}

`;break}case"assistant":{let e=n.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new eq({functionality:"tool-call messages"})}}).join("");s+=`${a}:
${e}

`;break}case"tool":throw new eq({functionality:"tool messages"});default:throw Error(`Unsupported role: ${t}`)}return{prompt:s+=`${a}:
`,stopSequences:[`
${r}:`]}}({prompt:r,inputFormat:t}),y=[...null!=g?g:[],...null!=u?u:[]],v={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:a,temperature:s,top_p:n,frequency_penalty:i,presence_penalty:l,seed:d,prompt:f,stop:y.length>0?y:void 0};switch(m){case"regular":if(null==(p=e.tools)?void 0:p.length)throw new eq({functionality:"tools"});if(e.toolChoice)throw new eq({functionality:"toolChoice"});return{args:v,warnings:h};case"object-json":throw new eq({functionality:"object-json mode"});case"object-tool":throw new eq({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${m}`)}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:a,value:s,rawValue:n}=await e6({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:eH(this.config.headers(),e.headers),body:t,failedResponseHandler:r6,successfulResponseHandler:e8(ao),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t,l=s.choices[0];return{text:l.text,usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},finishReason:r2(l.finish_reason),logprobs:as(l.logprobs),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a,body:n},response:r5(s),warnings:r,request:{body:JSON.stringify(t)}}}async doStream(e){let t;let{args:r,warnings:a}=this.getArgs(e),s={...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:n,value:o}=await e6({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:eH(this.config.headers(),e.headers),body:s,failedResponseHandler:r6,successfulResponseHandler:e7(ai),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:i,...l}=r,u="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d=!0;return{stream:o.pipeThrough(new TransformStream({transform(e,r){if(!e.success){u="error",r.enqueue({type:"error",error:e.error});return}let a=e.value;if("error"in a){u="error",r.enqueue({type:"error",error:a.error});return}d&&(d=!1,r.enqueue({type:"response-metadata",...r5(a)})),null!=a.usage&&(c={promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens});let s=a.choices[0];(null==s?void 0:s.finish_reason)!=null&&(u=r2(s.finish_reason)),(null==s?void 0:s.text)!=null&&r.enqueue({type:"text-delta",textDelta:s.text});let n=as(null==s?void 0:s.logprobs);(null==n?void 0:n.length)&&(void 0===t&&(t=[]),t.push(...n))},flush(e){e.enqueue({type:"finish",finishReason:u,logprobs:t,usage:c})}})),rawCall:{rawPrompt:i,rawSettings:l},rawResponse:{headers:n},warnings:a,request:{body:JSON.stringify(s)}}}},ao=r9.object({id:r9.string().nullish(),created:r9.number().nullish(),model:r9.string().nullish(),choices:r9.array(r9.object({text:r9.string(),finish_reason:r9.string(),logprobs:r9.object({tokens:r9.array(r9.string()),token_logprobs:r9.array(r9.number()),top_logprobs:r9.array(r9.record(r9.string(),r9.number())).nullable()}).nullish()})),usage:r9.object({prompt_tokens:r9.number(),completion_tokens:r9.number()})}),ai=r9.union([r9.object({id:r9.string().nullish(),created:r9.number().nullish(),model:r9.string().nullish(),choices:r9.array(r9.object({text:r9.string(),finish_reason:r9.string().nullish(),index:r9.number(),logprobs:r9.object({tokens:r9.array(r9.string()),token_logprobs:r9.array(r9.number()),top_logprobs:r9.array(r9.record(r9.string(),r9.number())).nullable()}).nullish()})),usage:r9.object({prompt_tokens:r9.number(),completion_tokens:r9.number()}).nullish()}),r3]),al=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new eN({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:s}=await e6({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:eH(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:r6,successfulResponseHandler:e8(au),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.data.map(e=>e.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:a}}}},au=r9.object({data:r9.array(r9.object({embedding:r9.array(r9.number())})),usage:r9.object({prompt_tokens:r9.number()}).nullish()}),ac={"dall-e-3":1,"dall-e-2":10},ad=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return null!=(t=null!=(e=this.settings.maxImagesPerCall)?e:ac[this.modelId])?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:a,seed:s,providerOptions:n,headers:o,abortSignal:i}){var l,u,c,d;let p=[];null!=a&&p.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=s&&p.push({type:"unsupported-setting",setting:"seed"});let m=null!=(c=null==(u=null==(l=this.config._internal)?void 0:l.currentDate)?void 0:u.call(l))?c:new Date,{value:h,responseHeaders:f}=await e6({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:eH(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:r,...null!=(d=n.openai)?d:{},response_format:"b64_json"},failedResponseHandler:r6,successfulResponseHandler:e8(ap),abortSignal:i,fetch:this.config.fetch});return{images:h.data.map(e=>e.b64_json),warnings:p,response:{timestamp:m,modelId:this.modelId,headers:f}}}},ap=r9.object({data:r9.array(r9.object({b64_json:r9.string()}))});function am({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var ah=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:r,stopSequences:a,topP:s,topK:n,presencePenalty:o,frequencyPenalty:i,seed:l,prompt:u,providerMetadata:c,responseFormat:d}){var p,m,h,f,g;let y=[],v=(g=this.modelId).startsWith("o")?g.startsWith("o1-mini")||g.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1},_=e.type;null!=n&&y.push({type:"unsupported-setting",setting:"topK"}),null!=l&&y.push({type:"unsupported-setting",setting:"seed"}),null!=o&&y.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=i&&y.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=a&&y.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:b,warnings:w}=function({prompt:e,systemMessageMode:t}){let r=[],a=[];for(let{role:s,content:n}of e)switch(s){case"system":switch(t){case"system":r.push({role:"system",content:n});break;case"developer":r.push({role:"developer",content:n});break;case"remove":a.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":r.push({role:"user",content:n.map(e=>{var t,r,a;switch(e.type){case"text":return{type:"input_text",text:e.text};case"image":return{type:"input_image",image_url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${tr(e.image)}`,detail:null==(a=null==(r=e.providerMetadata)?void 0:r.openai)?void 0:a.imageDetail};case"file":throw new eq({functionality:"Image content parts in user messages"})}})});break;case"assistant":for(let e of n)switch(e.type){case"text":r.push({role:"assistant",content:[{type:"output_text",text:e.text}]});break;case"tool-call":r.push({type:"function_call",call_id:e.toolCallId,name:e.toolName,arguments:JSON.stringify(e.args)})}break;case"tool":for(let e of n)r.push({type:"function_call_output",call_id:e.toolCallId,output:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${s}`)}return{messages:r,warnings:a}}({prompt:u,systemMessageMode:v.systemMessageMode});y.push(...w);let x=null!=c?e9({value:c,schema:aT}):{success:!0,value:void 0};if(!x.success)throw new en({argument:"providerOptions",message:"invalid provider options",cause:x.error});let k=null==(p=x.value)?void 0:p.openai,T=null==(m=null==k?void 0:k.strictSchemas)||m,S={model:this.modelId,input:b,temperature:r,top_p:s,max_output_tokens:t,...(null==d?void 0:d.type)==="json"&&{text:{format:null!=d.schema?{type:"json_schema",strict:T,name:null!=(h=d.name)?h:"response",description:d.description,schema:d.schema}:{type:"json_object"}}},metadata:null==k?void 0:k.metadata,parallel_tool_calls:null==k?void 0:k.parallelToolCalls,previous_response_id:null==k?void 0:k.previousResponseId,store:null==k?void 0:k.store,user:null==k?void 0:k.user,...v.isReasoningModel&&(null==k?void 0:k.reasoningEffort)!=null&&{reasoning:{effort:null==k?void 0:k.reasoningEffort}},...v.requiredAutoTruncation&&{truncation:"auto"}};switch(v.isReasoningModel&&(null!=S.temperature&&(S.temperature=void 0,y.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=S.top_p&&(S.top_p=void 0,y.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),_){case"regular":{let{tools:t,tool_choice:r,toolWarnings:a}=function({mode:e,strict:t}){var r;let a=(null==(r=e.tools)?void 0:r.length)?e.tools:void 0,s=[];if(null==a)return{tools:void 0,tool_choice:void 0,toolWarnings:s};let n=e.toolChoice,o=[];for(let e of a)switch(e.type){case"function":o.push({type:"function",name:e.name,description:e.description,parameters:e.parameters,strict:!!t||void 0});break;case"provider-defined":"openai.web_search_preview"===e.id?o.push({type:"web_search_preview",search_context_size:e.args.searchContextSize,user_location:e.args.userLocation}):s.push({type:"unsupported-tool",tool:e});break;default:s.push({type:"unsupported-tool",tool:e})}if(null==n)return{tools:o,tool_choice:void 0,toolWarnings:s};let i=n.type;switch(i){case"auto":case"none":case"required":return{tools:o,tool_choice:i,toolWarnings:s};case"tool":return{tools:o,tool_choice:{type:"function",name:n.toolName},toolWarnings:s};default:throw new eq({functionality:`Unsupported tool choice type: ${i}`})}}({mode:e,strict:T});return{args:{...S,tools:t,tool_choice:r},warnings:[...y,...a]}}case"object-json":return{args:{...S,text:{format:null!=e.schema?{type:"json_schema",strict:T,name:null!=(f=e.name)?f:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:y};case"object-tool":return{args:{...S,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:T}]},warnings:y};default:throw Error(`Unsupported type: ${_}`)}}async doGenerate(e){var t,r,a,s,n;let{args:o,warnings:i}=this.getArgs(e),{responseHeaders:l,value:u,rawValue:c}=await e6({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:eH(this.config.headers(),e.headers),body:o,failedResponseHandler:r6,successfulResponseHandler:e8(r9.object({id:r9.string(),created_at:r9.number(),model:r9.string(),output:r9.array(r9.discriminatedUnion("type",[r9.object({type:r9.literal("message"),role:r9.literal("assistant"),content:r9.array(r9.object({type:r9.literal("output_text"),text:r9.string(),annotations:r9.array(r9.object({type:r9.literal("url_citation"),start_index:r9.number(),end_index:r9.number(),url:r9.string(),title:r9.string()}))}))}),r9.object({type:r9.literal("function_call"),call_id:r9.string(),name:r9.string(),arguments:r9.string()}),r9.object({type:r9.literal("web_search_call")}),r9.object({type:r9.literal("computer_call")}),r9.object({type:r9.literal("reasoning")})])),incomplete_details:r9.object({reason:r9.string()}).nullable(),usage:af})),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=u.output.filter(e=>"message"===e.type).flatMap(e=>e.content).filter(e=>"output_text"===e.type),p=u.output.filter(e=>"function_call"===e.type).map(e=>({toolCallType:"function",toolCallId:e.call_id,toolName:e.name,args:e.arguments}));return{text:d.map(e=>e.text).join("\n"),sources:d.flatMap(e=>e.annotations.map(e=>{var t,r,a;return{sourceType:"url",id:null!=(a=null==(r=(t=this.config).generateId)?void 0:r.call(t))?a:eQ(),url:e.url,title:e.title}})),finishReason:am({finishReason:null==(t=u.incomplete_details)?void 0:t.reason,hasToolCalls:p.length>0}),toolCalls:p.length>0?p:void 0,usage:{promptTokens:u.usage.input_tokens,completionTokens:u.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:l,body:c},request:{body:JSON.stringify(o)},response:{id:u.id,timestamp:new Date(1e3*u.created_at),modelId:u.model},providerMetadata:{openai:{responseId:u.id,cachedPromptTokens:null!=(a=null==(r=u.usage.input_tokens_details)?void 0:r.cached_tokens)?a:null,reasoningTokens:null!=(n=null==(s=u.usage.output_tokens_details)?void 0:s.reasoning_tokens)?n:null}},warnings:i}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:a,value:s}=await e6({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:eH(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:r6,successfulResponseHandler:e7(ak),abortSignal:e.abortSignal,fetch:this.config.fetch}),n=this,o="unknown",i=NaN,l=NaN,u=null,c=null,d=null,p={},m=!1;return{stream:s.pipeThrough(new TransformStream({transform(e,t){var r,a,s,h,f,g,y,v,_;if(!e.success){o="error",t.enqueue({type:"error",error:e.error});return}let b=e.value;if("response.output_item.added"===b.type)"function_call"===b.item.type&&(p[b.output_index]={toolName:b.item.name,toolCallId:b.item.call_id},t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:b.item.call_id,toolName:b.item.name,argsTextDelta:b.item.arguments}));else if("response.function_call_arguments.delta"===b.type){let e=p[b.output_index];null!=e&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:e.toolCallId,toolName:e.toolName,argsTextDelta:b.delta})}else{"response.created"===b.type?(d=b.response.id,t.enqueue({type:"response-metadata",id:b.response.id,timestamp:new Date(1e3*b.response.created_at),modelId:b.response.model})):"response.output_text.delta"===b.type?t.enqueue({type:"text-delta",textDelta:b.delta}):"response.output_item.done"===b.type&&"function_call"===b.item.type?(p[b.output_index]=void 0,m=!0,t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:b.item.call_id,toolName:b.item.name,args:b.item.arguments})):"response.completed"===(_=b).type||"response.incomplete"===_.type?(o=am({finishReason:null==(r=b.response.incomplete_details)?void 0:r.reason,hasToolCalls:m}),i=b.response.usage.input_tokens,l=b.response.usage.output_tokens,u=null!=(s=null==(a=b.response.usage.input_tokens_details)?void 0:a.cached_tokens)?s:u,c=null!=(f=null==(h=b.response.usage.output_tokens_details)?void 0:h.reasoning_tokens)?f:c):"response.output_text.annotation.added"===b.type&&t.enqueue({type:"source",source:{sourceType:"url",id:null!=(v=null==(y=(g=n.config).generateId)?void 0:y.call(g))?v:eQ(),url:b.annotation.url,title:b.annotation.title}})}},flush(e){e.enqueue({type:"finish",finishReason:o,usage:{promptTokens:i,completionTokens:l},...(null!=u||null!=c)&&{providerMetadata:{openai:{responseId:d,cachedPromptTokens:u,reasoningTokens:c}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:a},request:{body:JSON.stringify(t)},warnings:r}}},af=r9.object({input_tokens:r9.number(),input_tokens_details:r9.object({cached_tokens:r9.number().nullish()}).nullish(),output_tokens:r9.number(),output_tokens_details:r9.object({reasoning_tokens:r9.number().nullish()}).nullish()}),ag=r9.object({type:r9.literal("response.output_text.delta"),delta:r9.string()}),ay=r9.object({type:r9.enum(["response.completed","response.incomplete"]),response:r9.object({incomplete_details:r9.object({reason:r9.string()}).nullish(),usage:af})}),av=r9.object({type:r9.literal("response.created"),response:r9.object({id:r9.string(),created_at:r9.number(),model:r9.string()})}),a_=r9.object({type:r9.literal("response.output_item.done"),output_index:r9.number(),item:r9.discriminatedUnion("type",[r9.object({type:r9.literal("message")}),r9.object({type:r9.literal("function_call"),id:r9.string(),call_id:r9.string(),name:r9.string(),arguments:r9.string(),status:r9.literal("completed")})])}),ab=r9.object({type:r9.literal("response.function_call_arguments.delta"),item_id:r9.string(),output_index:r9.number(),delta:r9.string()}),aw=r9.object({type:r9.literal("response.output_item.added"),output_index:r9.number(),item:r9.discriminatedUnion("type",[r9.object({type:r9.literal("message")}),r9.object({type:r9.literal("function_call"),id:r9.string(),call_id:r9.string(),name:r9.string(),arguments:r9.string()})])}),ax=r9.object({type:r9.literal("response.output_text.annotation.added"),annotation:r9.object({type:r9.literal("url_citation"),url:r9.string(),title:r9.string()})}),ak=r9.union([ag,ay,av,a_,ab,aw,ax,r9.object({type:r9.string()}).passthrough()]),aT=r9.object({openai:r9.object({metadata:r9.any().nullish(),parallelToolCalls:r9.boolean().nullish(),previousResponseId:r9.string().nullish(),store:r9.boolean().nullish(),user:r9.string().nullish(),reasoningEffort:r9.string().nullish(),strictSchemas:r9.boolean().nullish()}).nullish()}),aS=r9.object({}),aI={webSearchPreview:function({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:aS}}},aE=function(e={}){var t,r,a,s;let n=null!=(t=null==(s=e.baseURL)?void 0:s.replace(/\/$/,""))?t:"https://api.openai.com/v1",o=null!=(r=e.compatibility)?r:"compatible",i=null!=(a=e.name)?a:"openai",l=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new ew({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new ew({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new ew({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new ew({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(t,r={})=>new r7(t,r,{provider:`${i}.chat`,url:({path:e})=>`${n}${e}`,headers:l,compatibility:o,fetch:e.fetch}),c=(t,r={})=>new an(t,r,{provider:`${i}.completion`,url:({path:e})=>`${n}${e}`,headers:l,compatibility:o,fetch:e.fetch}),d=(t,r={})=>new al(t,r,{provider:`${i}.embedding`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),p=(t,r={})=>new ad(t,r,{provider:`${i}.image`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),m=(e,t)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?c(e,t):u(e,t)},h=function(e,t){return m(e,t)};return h.languageModel=m,h.chat=u,h.completion=c,h.responses=t=>new ah(t,{provider:`${i}.responses`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),h.embedding=d,h.textEmbedding=d,h.textEmbeddingModel=d,h.image=p,h.imageModel=p,h.tools=aI,h}({compatibility:"strict"}),aj=r(76895),aA=r(89131);let aC=Symbol("Let zodToJsonSchema decide on which parser to use"),aN={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},aO=e=>"string"==typeof e?{...aN,name:e}:{...aN,...e},aR=e=>{let t=aO(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function aP(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function aM(e,t,r,a,s){e[t]=r,aP(e,t,a,s)}function a$(e,t){return a0(e.type._def,t)}let aZ=(e,t)=>a0(e.innerType._def,t),aD=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":aM(r,"minimum",a.value,a.message,t);break;case"max":aM(r,"maximum",a.value,a.message,t)}return r},aq=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,aF={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===s&&(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function aL(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":aM(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":aM(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":aB(r,"email",a.message,t);break;case"format:idn-email":aB(r,"idn-email",a.message,t);break;case"pattern:zod":az(r,aF.email,a.message,t)}break;case"url":aB(r,"uri",a.message,t);break;case"uuid":aB(r,"uuid",a.message,t);break;case"regex":az(r,a.regex,a.message,t);break;case"cuid":az(r,aF.cuid,a.message,t);break;case"cuid2":az(r,aF.cuid2,a.message,t);break;case"startsWith":az(r,RegExp(`^${aU(a.value,t)}`),a.message,t);break;case"endsWith":az(r,RegExp(`${aU(a.value,t)}$`),a.message,t);break;case"datetime":aB(r,"date-time",a.message,t);break;case"date":aB(r,"date",a.message,t);break;case"time":aB(r,"time",a.message,t);break;case"duration":aB(r,"duration",a.message,t);break;case"length":aM(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),aM(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":az(r,RegExp(aU(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&aB(r,"ipv4",a.message,t),"v4"!==a.version&&aB(r,"ipv6",a.message,t);break;case"base64url":az(r,aF.base64url,a.message,t);break;case"jwt":az(r,aF.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&az(r,aF.ipv4Cidr,a.message,t),"v4"!==a.version&&az(r,aF.ipv6Cidr,a.message,t);break;case"emoji":az(r,aF.emoji(),a.message,t);break;case"ulid":az(r,aF.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":aB(r,"binary",a.message,t);break;case"contentEncoding:base64":aM(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":az(r,aF.base64,a.message,t)}break;case"nanoid":az(r,aF.nanoid,a.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function aU(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)aV.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let aV=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function aB(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):aM(e,"format",t,r,a)}function az(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:aJ(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):aM(e,"pattern",aJ(t,a),r,a)}function aJ(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,s="",n=!1,o=!1,i=!1;for(let e=0;e<a.length;e++){if(n){s+=a[e],n=!1;continue}if(r.i){if(o){if(a[e].match(/[a-z]/)){i?(s+=a[e],s+=`${a[e-2]}-${a[e]}`.toUpperCase(),i=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(s+=a[e],i=!0):s+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){s+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){s+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){s+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){s+=o?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}s+=a[e],"\\"===a[e]?n=!0:o&&"]"===a[e]?o=!1:o||"["!==a[e]||(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function aK(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===x.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:a0(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:a0(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===x.ZodString&&e.keyType._def.checks?.length){let{type:a,...s}=aL(e.keyType._def,t);return{...r,propertyNames:s}}if(e.keyType?._def.typeName===x.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===x.ZodBranded&&e.keyType._def.type._def.typeName===x.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...s}=a$(e.keyType._def,t);return{...r,propertyNames:s}}return r}let aW={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},aH=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>a0(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},aY=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return a0(e.innerType._def,t);let r=a0(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},aG=(e,t)=>{if("input"===t.pipeStrategy)return a0(e.in._def,t);if("output"===t.pipeStrategy)return a0(e.out._def,t);let r=a0(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=a0(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},aX=(e,t)=>a0(e.innerType._def,t),aQ=(e,t,r)=>{switch(t){case x.ZodString:return aL(e,r);case x.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",aP(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?aM(r,"minimum",a.value,a.message,t):aM(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),aM(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?aM(r,"maximum",a.value,a.message,t):aM(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),aM(r,"maximum",a.value,a.message,t));break;case"multipleOf":aM(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case x.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",...Object.entries(e.shape()).reduce((e,[a,s])=>{if(void 0===s||void 0===s._def)return e;let n=s.isOptional();n&&r&&(s instanceof rc&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),n=!1);let o=a0(s._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return void 0===o?e:{properties:{...e.properties,[a]:o},required:n?e.required:[...e.required,a]}},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:a0(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:a0(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return a.required.length||delete a.required,a}(e,r);case x.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?aM(r,"minimum",a.value,a.message,t):aM(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),aM(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?aM(r,"maximum",a.value,a.message,t):aM(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),aM(r,"maximum",a.value,a.message,t));break;case"multipleOf":aM(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case x.ZodBoolean:return{type:"boolean"};case x.ZodDate:return function e(t,r,a){let s=a??r.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((a,s)=>e(t,r,a))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return aD(t,r)}}(e,r);case x.ZodUndefined:return{not:{}};case x.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case x.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==x.ZodAny&&(r.items=a0(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&aM(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&aM(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(aM(r,"minItems",e.exactLength.value,e.exactLength.message,t),aM(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case x.ZodUnion:case x.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return aH(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in aW&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=aW[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return aH(e,t)}(e,r);case x.ZodIntersection:return function(e,t){let r=[a0(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a0(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,s=[];return r.forEach(e=>{if(aq(e))s.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;s.push(t)}}),s.length?{allOf:s,...a}:void 0}(e,r);case x.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>a0(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:a0(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>a0(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case x.ZodRecord:return aK(e,r);case x.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case x.ZodEnum:return{type:"string",enum:Array.from(e.values)};case x.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case x.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:aW[e.innerType._def.typeName],nullable:!0}:{type:[aW[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=a0(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=a0(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case x.ZodOptional:return aY(e,r);case x.ZodMap:return function(e,t){return"record"===t.mapStrategy?aK(e,t):{type:"array",maxItems:125,items:{type:"array",items:[a0(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},a0(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case x.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:a0(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&aM(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&aM(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case x.ZodLazy:return()=>e.getter()._def;case x.ZodPromise:return a0(e.type._def,r);case x.ZodNaN:case x.ZodNever:return{not:{}};case x.ZodEffects:return function(e,t){return"input"===t.effectStrategy?a0(e.schema._def,t):{}}(e,r);case x.ZodAny:case x.ZodUnknown:return{};case x.ZodDefault:return function(e,t){return{...a0(e.innerType._def,t),default:e.defaultValue()}}(e,r);case x.ZodBranded:return a$(e,r);case x.ZodReadonly:return aX(e,r);case x.ZodCatch:return aZ(e,r);case x.ZodPipeline:return aG(e,r);case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:default:return}};function a0(e,t,r=!1){let a=t.seen.get(e);if(t.override){let s=t.override?.(e,t,a,r);if(s!==aC)return s}if(a&&!r){let e=a1(a,t);if(void 0!==e)return e}let s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);let n=aQ(e,e.typeName,t),o="function"==typeof n?a0(n(),t):n;if(o&&a4(e,t,o),t.postProcess){let r=t.postProcess(o,e,t);return s.jsonSchema=o,r}return s.jsonSchema=o,o}let a1=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:a9(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},a9=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},a4=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),a2=(e,t)=>{let r=aR(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:a0(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,n=a0(e._def,void 0===s?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(n.title=o);let i=void 0===s?a?{...n,[r.definitionPath]:a}:n:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...a,[s]:n}};return"jsonSchema7"===r.target?i.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var a3={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},a6={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},a5={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},a7={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},a8={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},se=[a3,a6,a5,a7,a8],st={[a3.code]:a3,[a6.code]:a6,[a5.code]:a5,[a7.code]:a7,[a8.code]:a8};a3.name,a3.code,a6.name,a6.code,a5.name,a5.code,a7.name,a7.code,a8.name,a8.code;var sr=se.map(e=>e.code);function sa(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=e4({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=e4({text:function(e){let t=["ROOT"],r=-1,a=null;function s(e,s,n){switch(e){case'"':r=s,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=s,a=s,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=s,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=s,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=s,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function o(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let i=0;i<e.length;i++){let l=e[i];switch(t[t.length-1]){case"ROOT":s(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===l?(r=i,t.pop()):(r=i,s(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(a,i+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i))}}}let i=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}var ss=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}}],sn=Object.fromEntries(ss.map(e=>[e.code,e]));Object.fromEntries(ss.map(e=>[e.name,e.code]));var so=ss.map(e=>e.code),si=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!so.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return sn[r].parse(a)};function sl(e,t){let r=ss.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}async function su({stream:e,onTextPart:t,onReasoningPart:r,onReasoningSignaturePart:a,onRedactedReasoningPart:s,onSourcePart:n,onDataPart:o,onErrorPart:i,onToolCallStreamingStartPart:l,onToolCallDeltaPart:u,onToolCallPart:c,onToolResultPart:d,onMessageAnnotationsPart:p,onFinishMessagePart:m,onFinishStepPart:h,onStartStepPart:f}){let g=e.getReader(),y=new TextDecoder,v=[],_=0;for(;;){let{value:e}=await g.read();if(e&&(v.push(e),_+=e.length,10!==e[e.length-1]))continue;if(0===v.length)break;let b=function(e,t){let r=new Uint8Array(t),a=0;for(let t of e)r.set(t,a),a+=t.length;return e.length=0,r}(v,_);for(let{type:e,value:g}of(_=0,y.decode(b,{stream:!0}).split("\n").filter(e=>""!==e).map(si)))switch(e){case"text":await (null==t?void 0:t(g));break;case"reasoning":await (null==r?void 0:r(g));break;case"reasoning_signature":await (null==a?void 0:a(g));break;case"redacted_reasoning":await (null==s?void 0:s(g));break;case"source":await (null==n?void 0:n(g));break;case"data":await (null==o?void 0:o(g));break;case"error":await (null==i?void 0:i(g));break;case"message_annotations":await (null==p?void 0:p(g));break;case"tool_call_streaming_start":await (null==l?void 0:l(g));break;case"tool_call_delta":await (null==u?void 0:u(g));break;case"tool_call":await (null==c?void 0:c(g));break;case"tool_result":await (null==d?void 0:d(g));break;case"finish_message":await (null==m?void 0:m(g));break;case"finish_step":await (null==h?void 0:h(g));break;case"start_step":await (null==f?void 0:f(g));break;default:throw Error(`Unknown stream part type: ${e}`)}}}async function sc({stream:e,onTextPart:t}){let r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:a}=await r.read();if(e)break;await t(a)}}var sd=Symbol.for("vercel.ai.schema");function sp(e){return"object"==typeof e&&null!==e&&sd in e&&!0===e[sd]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[sd]:!0,_type:void 0,[e1]:!0,jsonSchema:e,validate:t}}(a2(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var sm=Object.defineProperty,sh=(e,t)=>{for(var r in t)sm(e,r,{get:t[r],enumerable:!0})};function sf(e,{contentType:t,dataStreamVersion:r}){let a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}function sg(e,{contentType:t,dataStreamVersion:r}){let a={};if(null!=e)for(let[t,r]of Object.entries(e))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function sy({response:e,status:t,statusText:r,headers:a,stream:s}){e.writeHead(null!=t?t:200,r,a);let n=s.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await n.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var sv="AI_InvalidArgumentError",s_=`vercel.ai.error.${sv}`,sb=Symbol.for(s_),sw=class extends J{constructor({parameter:e,value:t,message:r}){super({name:sv,message:`Invalid argument for parameter ${e}: ${r}`}),this[k]=!0,this.parameter=e,this.value=t}static isInstance(e){return J.hasMarker(e,s_)}};k=sb;var sx="AI_RetryError",sk=`vercel.ai.error.${sx}`,sT=Symbol.for(sk),sS=class extends J{constructor({message:e,reason:t,errors:r}){super({name:sx,message:e}),this[T]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return J.hasMarker(e,sk)}};T=sT;var sI=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>sE(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function sE(e,{maxRetries:t,delayInMs:r,backoffFactor:a},s=[]){try{return await e()}catch(l){if(e0(l)||0===t)throw l;let n=null==l?"unknown error":"string"==typeof l?l:l instanceof Error?l.message:JSON.stringify(l),o=[...s,l],i=o.length;if(i>t)throw new sS({message:`Failed after ${i} attempts. Last error: ${n}`,reason:"maxRetriesExceeded",errors:o});if(l instanceof Error&&Y.isInstance(l)&&!0===l.isRetryable&&i<=t)return await eY(r),sE(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},o);if(1===i)throw l;throw new sS({message:`Failed after ${i} attempts with non-retryable error: '${n}'`,reason:"errorNotRetryable",errors:o})}}function sj({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new sw({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new sw({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:sI({maxRetries:t})}}function sA({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function sC({model:e,settings:t,telemetry:r,headers:a}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(s=null==r?void 0:r.metadata)?s:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var sN={startSpan:()=>sO,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(sO):"function"==typeof r?r(sO):"function"==typeof a?a(sO):void 0},sO={spanContext:()=>sR,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},sR={traceId:"",spanId:"",traceFlags:0};function sP({isEnabled:e=!1,tracer:t}={}){return e?t||aj.u.getTracer("ai"):sN}function sM({name:e,tracer:t,attributes:r,fn:a,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return s&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:aA.s.ERROR,message:t.message})):e.setStatus({code:aA.s.ERROR})}finally{e.end()}throw t}})}function s$({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let s=a.input();return void 0===s?t:{...t,[r]:s}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let s=a.output();return void 0===s?t:{...t,[r]:s}}return{...t,[r]:a}},{})}var sZ="AI_NoImageGeneratedError",sD=`vercel.ai.error.${sZ}`;S=Symbol.for(sD);var sq="AI_NoObjectGeneratedError",sF=`vercel.ai.error.${sq}`,sL=Symbol.for(sF),sU=class extends J{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:s}){super({name:sq,message:e,cause:t}),this[I]=!0,this.text=r,this.response=a,this.usage=s}static isInstance(e){return J.hasMarker(e,sF)}};I=sL;var sV="AI_DownloadError",sB=`vercel.ai.error.${sV}`,sz=Symbol.for(sB),sJ=class extends J{constructor({url:e,statusCode:t,statusText:r,cause:a,message:s=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:sV,message:s,cause:a}),this[E]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return J.hasMarker(e,sB)}};async function sK({url:e,fetchImplementation:t=fetch}){var r;let a=e.toString();try{let e=await t(a);if(!e.ok)throw new sJ({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(sJ.isInstance(e))throw e;throw new sJ({url:a,cause:e})}}E=sz;var sW=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}],sH="AI_InvalidDataContentError",sY=`vercel.ai.error.${sH}`,sG=Symbol.for(sY),sX=class extends J{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:sH,message:r,cause:t}),this[j]=!0,this.content=e}static isInstance(e){return J.hasMarker(e,sY)}};j=sG;var sQ=r9.union([r9.string(),r9.instanceof(Uint8Array),r9.instanceof(ArrayBuffer),r9.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function s0(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return function(e){let t=tt(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}(e)}catch(t){throw new sX({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new sX({content:e})}var s1="AI_InvalidMessageRoleError",s9=`vercel.ai.error.${s1}`,s4=Symbol.for(s9),s2=class extends J{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:s1,message:t}),this[A]=!0,this.role=e}static isInstance(e){return J.hasMarker(e,s9)}};async function s3({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=sK}){let s=await s6(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,a,s,n,o,i;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,a,s,n,o;let i,l,u;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let c=e.mimeType,d=e.type;switch(d){case"image":i=e.image;break;case"file":i=e.data;break;default:throw Error(`Unsupported part type: ${d}`)}try{l="string"==typeof i?new URL(i):i}catch(e){l=i}if(l instanceof URL){if("data:"===l.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(l.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${d}`);c=e,u=s0(t)}else{let e=t[l.toString()];e?(u=e.data,null!=c||(c=e.mimeType)):u=l}}else u=s0(l);switch(d){case"image":return u instanceof Uint8Array&&(c=null!=(a=function(e){for(let{bytes:t,mimeType:r}of sW)if(e.length>=t.length&&t.every((t,r)=>e[r]===t))return r}(u))?a:c),{type:"image",image:u,mimeType:c,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"file":if(null==c)throw Error("Mime type is missing for file part");return{type:"file",data:u instanceof Uint8Array?"string"==typeof(o=u)?o:o instanceof ArrayBuffer?tr(new Uint8Array(o)):tr(o):u,mimeType:c,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let{experimental_providerMetadata:t,providerOptions:r,...a}=e;return{...a,providerMetadata:null!=r?r:t}}),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};default:throw new s2({role:l})}})(e,s))]}async function s6(e,t,r,a){let s=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>"image"!==e.type||!0!==r).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(s.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function s5({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:o,seed:i}){if(null!=e){if(!Number.isInteger(e))throw new sw({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new sw({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new sw({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new sw({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new sw({parameter:"topK",value:a,message:"topK must be a number"});if(null!=s&&"number"!=typeof s)throw new sw({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new sw({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new sw({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:null!=o&&o.length>0?o:void 0,seed:i}}A=s4;var s7="AI_MessageConversionError",s8=`vercel.ai.error.${s7}`,ne=Symbol.for(s8),nt=class extends J{constructor({originalMessage:e,message:t}){super({name:s7,message:t}),this[C]=!0,this.originalMessage=e}static isInstance(e){return J.hasMarker(e,s8)}};function nr(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}C=ne;var na=r9.lazy(()=>r9.union([r9.null(),r9.string(),r9.number(),r9.boolean(),r9.record(r9.string(),na),r9.array(na)])),ns=r9.record(r9.string(),r9.record(r9.string(),na)),nn=r9.array(r9.union([r9.object({type:r9.literal("text"),text:r9.string()}),r9.object({type:r9.literal("image"),data:r9.string(),mimeType:r9.string().optional()})])),no=r9.object({type:r9.literal("text"),text:r9.string(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),ni=r9.object({type:r9.literal("image"),image:r9.union([sQ,r9.instanceof(URL)]),mimeType:r9.string().optional(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nl=r9.object({type:r9.literal("file"),data:r9.union([sQ,r9.instanceof(URL)]),mimeType:r9.string(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nu=r9.object({type:r9.literal("reasoning"),text:r9.string(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nc=r9.object({type:r9.literal("redacted-reasoning"),data:r9.string(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nd=r9.object({type:r9.literal("tool-call"),toolCallId:r9.string(),toolName:r9.string(),args:r9.unknown(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),np=r9.object({type:r9.literal("tool-result"),toolCallId:r9.string(),toolName:r9.string(),result:r9.unknown(),content:nn.optional(),isError:r9.boolean().optional(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nm=r9.object({role:r9.literal("system"),content:r9.string(),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nh=r9.object({role:r9.literal("user"),content:r9.union([r9.string(),r9.array(r9.union([no,ni,nl]))]),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),nf=r9.object({role:r9.literal("assistant"),content:r9.union([r9.string(),r9.array(r9.union([no,nu,nc,nd]))]),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),ng=r9.object({role:r9.literal("tool"),content:r9.array(np),providerOptions:ns.optional(),experimental_providerMetadata:ns.optional()}),ny=r9.union([nm,nh,nf,ng]);function nv({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new eu({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new eu({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new eu({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new eu({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(nr);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new eu({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let a="ui-messages"===r?function(e,t){var r,a;let s=null!=(r=null==t?void 0:t.tools)?r:{},n=[];for(let t=0;t<e.length;t++){let r=e[t],o=t===e.length-1,{role:i,content:l,experimental_attachments:u}=r;switch(i){case"system":n.push({role:"system",content:l});break;case"user":n.push({role:"user",content:u?[{type:"text",text:l},...function(e){var t,r,a;let s=[];for(let n of e){let e;try{e=new URL(n.url)}catch(e){throw Error(`Invalid URL: ${n.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=n.contentType)?void 0:t.startsWith("image/"))s.push({type:"image",image:e});else{if(!n.contentType)throw Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:e,mimeType:n.contentType})}break;case"data:":{let e,t,o;try{[e,t]=n.url.split(","),o=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${n.url}`)}if(null==o||null==t)throw Error(`Invalid data URL format: ${n.url}`);if(null==(r=n.contentType)?void 0:r.startsWith("image/"))s.push({type:"image",image:s0(t)});else if(null==(a=n.contentType)?void 0:a.startsWith("text/"))s.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(s0(t))});else{if(!n.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:t,mimeType:n.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return s}(u)]:l});break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of i)switch(t.type){case"text":e.push({type:"text",text:t.text});break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}n.push({role:"assistant",content:e});let a=i.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);a.length>0&&n.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new nt({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:n}=e,o=s[a];return(null==o?void 0:o.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:o.experimental_toToolResultContent(n),experimental_content:o.experimental_toToolResultContent(n)}:{type:"tool-result",toolCallId:t,toolName:a,result:n}})}),i=[],o=!1,t++},t=0,o=!1,i=[];for(let s of r.parts)switch(s.type){case"reasoning":i.push(s);break;case"text":o&&e(),i.push(s);break;case"tool-invocation":(null!=(a=s.toolInvocation.step)?a:0)!==t&&e(),i.push(s),o=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){n.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let a=0;a<=t;a++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===a});0!==t.length&&(n.push({role:"assistant",content:[...o&&l&&0===a?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),n.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new nt({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:n}=e,o=s[a];return(null==o?void 0:o.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:o.experimental_toToolResultContent(n),experimental_content:o.experimental_toToolResultContent(n)}:{type:"tool-result",toolCallId:t,toolName:a,result:n}})}))}l&&!o&&n.push({role:"assistant",content:l});break}case"data":break;default:throw new nt({originalMessage:r,message:`Unsupported role: ${i}`})}}return n}(e.messages,{tools:t}):e.messages,s=e9({value:a,schema:r9.array(ny)});if(!s.success)throw new eu({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:s.error});return{type:"messages",messages:a,system:e.system}}throw Error("unreachable")}function n_({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function nb({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:a=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter(e=>null!=e).join("\n")}function nw(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}var nx={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:(e,t)=>void 0===e?{success:!1,error:new sU({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage})}:{success:!0,value:e},createElementStream(){throw new eq({functionality:"element streams in no-schema mode"})}},nk=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:t=>safeValidateTypes2({value:t,schema:e}),createElementStream(){throw new UnsupportedFunctionalityError({functionality:"element streams in object mode"})}}),nT=e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},validatePartialResult({value:t,latestObject:r,isFirstDelta:a,isFinalDelta:s}){var n;if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let o=t.elements,i=[];for(let t=0;t<o.length;t++){let r=safeValidateTypes2({value:o[t],schema:e});if(t!==o.length-1||s){if(!r.success)return r;i.push(r.value)}}let l=null!=(n=null==r?void 0:r.length)?n:0,u="";return a&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),s&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},validateFinalResult(t){if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=safeValidateTypes2({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return nw(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let a=e.object;for(;t<a.length;t++)r.enqueue(a[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},nS=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new TypeValidationError({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new UnsupportedFunctionalityError({functionality:"partial results in enum mode"})},createElementStream(){throw new UnsupportedFunctionalityError({functionality:"element streams in enum mode"})}});eX({prefix:"aiobj",size:24});var nI=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function nE(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function nj(){let e=[],t=null,r=!1,a=nE(),s=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=nE(),await a.promise,s();try{let{value:a,done:n}=await e[0].read();n?(e.shift(),e.length>0?await s():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:s,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}eX({prefix:"aiobj",size:24});var nA="AI_NoOutputSpecifiedError",nC=`vercel.ai.error.${nA}`,nN=Symbol.for(nC),nO=class extends J{constructor({message:e="No output specified."}={}){super({name:nA,message:e}),this[N]=!0}static isInstance(e){return J.hasMarker(e,nC)}};N=nN;var nR="AI_ToolExecutionError",nP=`vercel.ai.error.${nR}`,nM=Symbol.for(nP),n$=class extends J{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:s=`Error executing tool ${t}: ${et(a)}`}){super({name:nR,message:s,cause:a}),this[O]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return J.hasMarker(e,nP)}};O=nM;var nZ=/^([\s\S]*?)(\s+)(\S*)$/,nD="AI_InvalidToolArgumentsError",nq=`vercel.ai.error.${nD}`,nF=Symbol.for(nq),nL=class extends J{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${et(r)}`}){super({name:nD,message:a,cause:r}),this[R]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return J.hasMarker(e,nq)}};R=nF;var nU="AI_NoSuchToolError",nV=`vercel.ai.error.${nU}`,nB=Symbol.for(nV),nz=class extends J{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:nU,message:r}),this[P]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return J.hasMarker(e,nV)}};P=nB;var nJ="AI_ToolCallRepairError",nK=`vercel.ai.error.${nJ}`,nW=Symbol.for(nK),nH=class extends J{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${et(e)}`}){super({name:nJ,message:r,cause:e}),this[M]=!0,this.originalError=t}static isInstance(e){return J.hasMarker(e,nK)}};async function nY({toolCall:e,tools:t,repairToolCall:r,system:a,messages:s}){if(null==t)throw new nz({toolName:e.toolName});try{return await nG({toolCall:e,tools:t})}catch(o){if(null==r||!(nz.isInstance(o)||nL.isInstance(o)))throw o;let n=null;try{n=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>sp(t[e].parameters).jsonSchema,system:a,messages:s,error:o})}catch(e){throw new nH({cause:e,originalError:o})}if(null==n)throw o;return await nG({toolCall:n,tools:t})}}async function nG({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new nz({toolName:e.toolName,availableTools:Object.keys(t)});let s=sp(a.parameters),n=""===e.args.trim()?e9({value:{},schema:s}):e4({text:e.args,schema:s});if(!1===n.success)throw new nL({toolName:r,toolArgs:e.args,cause:n.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:n.value}}function nX({text:e="",reasoning:t,tools:r,toolCalls:a,toolResults:s,messageId:n,generateMessageId:o}){let i=[];return i.push({role:"assistant",content:[...t.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"}),{type:"text",text:e},...a],id:n}),s.length>0&&i.push({role:"tool",id:o(),content:s.map(e=>{let t=r[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),i}M=nW,eX({prefix:"aitxt",size:24}),eX({prefix:"msg",size:24});sh({},{object:()=>n5,text:()=>n6});var nQ="AI_InvalidStreamPartError",n0=`vercel.ai.error.${nQ}`,n1=Symbol.for(n0),n9=class extends J{constructor({chunk:e,message:t}){super({name:nQ,message:t}),this[$]=!0,this.chunk=e}static isInstance(e){return J.hasMarker(e,n0)}};$=n1;var n4="vercel.ai.error.AI_MCPClientError",n2=Symbol.for(n4),n3=class extends J{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[Z]=!0}static isInstance(e){return J.hasMarker(e,n4)}};Z=n2;var n6=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),n5=({schema:e})=>{let t=sp(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:nb({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=sa(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let a=e4({text:e});if(!a.success)throw new sU({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage});let s=e9({value:a.value,schema:t});if(!s.success)throw new sU({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:r.response,usage:r.usage});return s.value}}};function n7(e,t){let r,a;let s=e.getReader(),n=t.getReader(),o=!1,i=!1;async function l(e){try{null==r&&(r=s.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=n.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(o){await u(e);return}if(i){await l(e);return}null==r&&(r=s.read()),null==a&&(a=n.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:s})),a.then(e=>({result:e,reader:n}))]);t.done||e.enqueue(t.value),c===s?(r=void 0,t.done&&(await u(e),o=!0)):(a=void 0,t.done&&(i=!0,await l(e)))}catch(t){e.error(t)}},cancel(){s.cancel(),n.cancel()}})}var n8=eX({prefix:"aitxt",size:24}),oe=eX({prefix:"msg",size:24}),ot=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:s,abortSignal:n,system:o,prompt:i,messages:l,tools:u,toolChoice:c,toolCallStreaming:d,transforms:p,activeTools:m,repairToolCall:h,maxSteps:f,output:g,continueSteps:y,providerOptions:v,now:_,currentDate:b,generateId:w,generateMessageId:x,onChunk:k,onError:T,onFinish:S,onStepFinish:I}){var E;let j,A,C,N;if(this.warningsPromise=new nI,this.usagePromise=new nI,this.finishReasonPromise=new nI,this.providerMetadataPromise=new nI,this.textPromise=new nI,this.reasoningPromise=new nI,this.reasoningDetailsPromise=new nI,this.sourcesPromise=new nI,this.toolCallsPromise=new nI,this.toolResultsPromise=new nI,this.requestPromise=new nI,this.responsePromise=new nI,this.stepsPromise=new nI,f<1)throw new sw({parameter:"maxSteps",value:f,message:"maxSteps must be at least 1"});this.output=g;let O="",R="",P="",M=[],$=[],Z=[],D={id:w(),timestamp:b(),modelId:e.modelId,messages:[]},q=[],F=[],L="initial",U=[],V=new TransformStream({async transform(e,t){t.enqueue(e);let{part:r}=e;if(("text-delta"===r.type||"reasoning"===r.type||"source"===r.type||"tool-call"===r.type||"tool-result"===r.type||"tool-call-streaming-start"===r.type||"tool-call-delta"===r.type)&&await (null==k?void 0:k({chunk:r})),"error"===r.type&&await (null==T?void 0:T({error:r.error})),"text-delta"===r.type&&(O+=r.textDelta,R+=r.textDelta,P+=r.textDelta),"reasoning"===r.type&&(null==A?(A={type:"text",text:r.textDelta},M.push(A)):A.text+=r.textDelta),"reasoning-signature"===r.type){if(null==A)throw new J({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});A.signature=r.signature,A=void 0}if("redacted-reasoning"===r.type&&M.push({type:"redacted",data:r.data}),"source"===r.type&&(Z.push(r.source),$.push(r.source)),"tool-call"===r.type&&q.push(r),"tool-result"===r.type&&F.push(r),"step-finish"===r.type){let e=nX({text:R,reasoning:M,tools:null!=u?u:{},toolCalls:q,toolResults:F,messageId:r.messageId,generateMessageId:x}),t=U.length,a="done";t+1<f&&(y&&"length"===r.finishReason&&0===q.length?a="continue":q.length>0&&F.length===q.length&&(a="tool-result"));let s={stepType:L,text:O,reasoning:function(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}(M),reasoningDetails:M,sources:$,toolCalls:q,toolResults:F,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...D.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await (null==I?void 0:I(s)),U.push(s),q=[],F=[],O="",$=[],M=[],A=void 0,"done"!==a&&(L=a),"continue"!==a&&(D.messages.push(...e),R="")}"finish"===r.type&&(D.id=r.response.id,D.timestamp=r.response.timestamp,D.modelId=r.response.modelId,D.headers=r.response.headers,N=r.usage,C=r.finishReason)},async flush(e){var r;try{if(0===U.length)return;let e=U[U.length-1];X.warningsPromise.resolve(e.warnings),X.requestPromise.resolve(e.request),X.responsePromise.resolve(e.response),X.toolCallsPromise.resolve(e.toolCalls),X.toolResultsPromise.resolve(e.toolResults),X.providerMetadataPromise.resolve(e.experimental_providerMetadata),X.reasoningPromise.resolve(e.reasoning),X.reasoningDetailsPromise.resolve(e.reasoningDetails);let a=null!=C?C:"unknown",s=null!=N?N:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};X.finishReasonPromise.resolve(a),X.usagePromise.resolve(s),X.textPromise.resolve(P),X.sourcesPromise.resolve(Z),X.stepsPromise.resolve(U),await (null==S?void 0:S({finishReason:a,logprobs:void 0,usage:s,text:P,reasoning:e.reasoning,reasoningDetails:e.reasoningDetails,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:U})),j.setAttributes(s$({telemetry:t,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>P},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":s.promptTokens,"ai.usage.completionTokens":s.completionTokens}}))}catch(t){e.error(t)}finally{j.end()}}}),B=nj();this.addStream=B.addStream,this.closeStream=B.close;let z=B.stream;for(let e of p)z=z.pipeThrough(e({tools:u,stopStream(){B.terminate()}}));this.baseStream=z.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",a="";function s({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(n,o){if("step-finish"===n.type&&s({controller:o}),"text-delta"!==n.type){o.enqueue({part:n,partialOutput:void 0});return}t+=n.textDelta,r+=n.textDelta;let i=e.parsePartial({text:t});if(null!=i){let e=JSON.stringify(i.partial);e!==a&&(s({controller:o,partialOutput:i.partial}),a=e)}},flush(e){r.length>0&&s({controller:e})}})}(g)).pipeThrough(V);let{maxRetries:K,retry:W}=sj({maxRetries:s}),H=sP(t),Y=sC({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:K}}),G=nv({prompt:{system:null!=(E=null==g?void 0:g.injectIntoSystemPrompt({system:o,model:e}))?E:o,prompt:i,messages:l},tools:u}),X=this;sM({name:"ai.streamText",attributes:s$({telemetry:t,attributes:{...sA({operationId:"ai.streamText",telemetry:t}),...Y,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:l})},"ai.settings.maxSteps":f}}),tracer:H,endWhenDone:!1,fn:async s=>{async function i({currentStep:s,responseMessages:l,usage:p,stepType:k,previousStepText:T,hasLeadingWhitespace:S,messageId:I}){var E;let j,A,C;let N=0===l.length?G.type:"messages",O=[...G.messages,...l],R=await s3({prompt:{type:N,system:G.system,messages:O},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(E=e.supportsUrl)?void 0:E.bind(e)}),P={type:"regular",...function({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:sp(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:u,toolChoice:c,activeTools:m})},{result:{stream:M,warnings:$,rawResponse:Z,request:D},doStreamSpan:q,startTimestampMs:F}=await W(()=>sM({name:"ai.streamText.doStream",attributes:s$({telemetry:t,attributes:{...sA({operationId:"ai.streamText.doStream",telemetry:t}),...Y,"ai.prompt.format":{input:()=>N},"ai.prompt.messages":{input:()=>JSON.stringify(R)},"ai.prompt.tools":{input:()=>{var e;return null==(e=P.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=P.toolChoice?JSON.stringify(P.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:H,endWhenDone:!1,fn:async t=>({startTimestampMs:_(),doStreamSpan:t,result:await e.doStream({mode:P,...s5(a),inputFormat:N,responseFormat:null==g?void 0:g.responseFormat({model:e}),prompt:R,providerMetadata:v,abortSignal:n,headers:r})})})),L=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:s,system:n,messages:o,abortSignal:i,repairToolCall:l}){let u,c=null,d=new ReadableStream({start(e){c=e}}),p={},m=new Set,h=!1;function f(){h&&0===m.size&&(null!=u&&c.enqueue(u),c.close())}let g=new TransformStream({async transform(t,d){let h=t.type;switch(h){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":d.enqueue(t);break;case"tool-call-delta":r&&(p[t.toolCallId]||(d.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),p[t.toolCallId]=!0),d.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{let r=await nY({toolCall:t,tools:e,repairToolCall:l,system:n,messages:o});d.enqueue(r);let u=e[r.toolName];if(null!=u.execute){let e=eQ();m.add(e),sM({name:"ai.toolCall",attributes:s$({telemetry:s,attributes:{...sA({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:a,fn:async t=>u.execute(r.args,{toolCallId:r.toolCallId,messages:o,abortSignal:i}).then(a=>{c.enqueue({...r,type:"tool-result",result:a}),m.delete(e),f();try{t.setAttributes(s$({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}},t=>{c.enqueue({type:"error",error:new n$({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:t})}),m.delete(e),f()})})}}catch(e){c.enqueue({type:"error",error:e})}break;case"finish":u={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:n_(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:M,toolCallStreaming:d,tracer:H,telemetry:t,system:o,messages:O,repairToolCall:h,abortSignal:n}),U=null!=D?D:{},V=[],B=[],z=[],J="unknown",K={promptTokens:0,completionTokens:0,totalTokens:0},Q=!0,ee="",et="continue"===k?T:"",er={id:w(),timestamp:b(),modelId:e.modelId},ea="",es=!1,en=!0,eo=!1;async function ei({controller:e,chunk:t}){e.enqueue(t),ee+=t.textDelta,et+=t.textDelta,es=!0,eo=t.textDelta.trimEnd()!==t.textDelta}X.addStream(L.pipeThrough(new TransformStream({async transform(e,t){var r,a,s;if(Q){let e=_()-F;Q=!1,q.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),q.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:I,request:U,warnings:null!=$?$:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;let n=e.type;switch(n){case"text-delta":if(y){let r=en&&S?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;en=!1;let a=function(e){let t=e.match(nZ);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}(ea+=r);null!=a&&(ea=a.suffix,await ei({controller:t,chunk:{type:"text-delta",textDelta:a.prefix+a.whitespace}}))}else await ei({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),null==C?(C={type:"text",text:e.textDelta},z.push(C)):C.text+=e.textDelta;break;case"reasoning-signature":if(t.enqueue(e),null==C)throw new n9({chunk:e,message:"reasoning-signature without reasoning"});C.signature=e.signature,C=void 0;break;case"redacted-reasoning":t.enqueue(e),z.push({type:"redacted",data:e.data});break;case"tool-call":t.enqueue(e),V.push(e);break;case"tool-result":t.enqueue(e),B.push(e);break;case"response-metadata":er={id:null!=(r=e.id)?r:er.id,timestamp:null!=(a=e.timestamp)?a:er.timestamp,modelId:null!=(s=e.modelId)?s:er.modelId};break;case"finish":{K=e.usage,J=e.finishReason,j=e.experimental_providerMetadata,A=e.logprobs;let t=_()-F;q.addEvent("ai.stream.finish"),q.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*K.completionTokens/t});break}case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"error":t.enqueue(e),J="error";break;default:throw Error(`Unknown chunk type: ${n}`)}},async flush(e){var r,a;let n=V.length>0?JSON.stringify(V):void 0,o="done";s+1<f&&(y&&"length"===J&&0===V.length?o="continue":V.length>0&&B.length===V.length&&(o="tool-result")),y&&ea.length>0&&("continue"!==o||"continue"===k&&!es)&&(await ei({controller:e,chunk:{type:"text-delta",textDelta:ea}}),ea="");try{q.setAttributes(s$({telemetry:t,attributes:{"ai.response.finishReason":J,"ai.response.text":{output:()=>ee},"ai.response.toolCalls":{output:()=>n},"ai.response.id":er.id,"ai.response.model":er.modelId,"ai.response.timestamp":er.timestamp.toISOString(),"ai.usage.promptTokens":K.promptTokens,"ai.usage.completionTokens":K.completionTokens,"gen_ai.response.finish_reasons":[J],"gen_ai.response.id":er.id,"gen_ai.response.model":er.modelId,"gen_ai.usage.input_tokens":K.promptTokens,"gen_ai.usage.output_tokens":K.completionTokens}}))}catch(e){}finally{q.end()}e.enqueue({type:"step-finish",finishReason:J,usage:K,providerMetadata:j,experimental_providerMetadata:j,logprobs:A,request:U,response:{...er,headers:null==Z?void 0:Z.headers},warnings:$,isContinued:"continue"===o,messageId:I});let c=(r=p,a=K,{promptTokens:r.promptTokens+a.promptTokens,completionTokens:r.completionTokens+a.completionTokens,totalTokens:r.totalTokens+a.totalTokens});if("done"===o)e.enqueue({type:"finish",finishReason:J,usage:c,providerMetadata:j,experimental_providerMetadata:j,logprobs:A,response:{...er,headers:null==Z?void 0:Z.headers}}),X.closeStream();else{if("continue"===k){let e=l[l.length-1];"string"==typeof e.content?e.content+=ee:e.content.push({text:ee,type:"text"})}else l.push(...nX({text:ee,reasoning:z,tools:null!=u?u:{},toolCalls:V,toolResults:B,messageId:I,generateMessageId:x}));await i({currentStep:s+1,responseMessages:l,usage:c,stepType:o,previousStepText:et,hasLeadingWhitespace:eo,messageId:"continue"===o?I:x()})}}})))}j=s,await i({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:x()})}}).catch(e=>{X.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),X.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return nw(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return nw(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(){for await(let e of this.fullStream);}get experimental_partialOutputStream(){if(null==this.output)throw new nO;return nw(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:a=!1,experimental_sendFinish:s=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(n,o)=>{let i=n.type;switch(i){case"text-delta":o.enqueue(sl("text",n.textDelta));break;case"reasoning":r&&o.enqueue(sl("reasoning",n.textDelta));break;case"redacted-reasoning":r&&o.enqueue(sl("redacted_reasoning",{data:n.data}));break;case"reasoning-signature":r&&o.enqueue(sl("reasoning_signature",{signature:n.signature}));break;case"source":a&&o.enqueue(sl("source",n.source));break;case"tool-call-streaming-start":o.enqueue(sl("tool_call_streaming_start",{toolCallId:n.toolCallId,toolName:n.toolName}));break;case"tool-call-delta":o.enqueue(sl("tool_call_delta",{toolCallId:n.toolCallId,argsTextDelta:n.argsTextDelta}));break;case"tool-call":o.enqueue(sl("tool_call",{toolCallId:n.toolCallId,toolName:n.toolName,args:n.args}));break;case"tool-result":o.enqueue(sl("tool_result",{toolCallId:n.toolCallId,result:n.result}));break;case"error":o.enqueue(sl("error",e(n.error)));break;case"step-start":o.enqueue(sl("start_step",{messageId:n.messageId}));break;case"step-finish":o.enqueue(sl("finish_step",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0,isContinued:n.isContinued}));break;case"finish":s&&o.enqueue(sl("finish_message",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${i}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:s,getErrorMessage:n,sendUsage:o,sendReasoning:i,sendSources:l,experimental_sendFinish:u}={}){sy({response:e,status:t,statusText:r,headers:sg(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:s,getErrorMessage:n,sendUsage:o,sendReasoning:i,sendSources:l,experimental_sendFinish:u})})}pipeTextStreamToResponse(e,t){sy({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:sg(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources,experimental_sendFinish:null==e?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?n7(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources,experimental_sendFinish:null==t?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:s,sendUsage:n,sendReasoning:o,sendSources:i,experimental_sendFinish:l}={}){return new Response(this.toDataStream({data:a,getErrorMessage:s,sendUsage:n,sendReasoning:o,sendSources:i,experimental_sendFinish:l}),{status:t,statusText:r,headers:sf(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:sf(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},or="AI_NoSuchProviderError",oa=`vercel.ai.error.${or}`,os=Symbol.for(oa),on=class extends eE{constructor({modelId:e,modelType:t,providerId:r,availableProviders:a,message:s=`No such provider: ${r} (available providers: ${a.join()})`}){super({errorName:or,modelId:e,modelType:t,message:s}),this[D]=!0,this.providerId=r,this.availableProviders=a}static isInstance(e){return J.hasMarker(e,oa)}};D=os;async function oo(e,t){var a,s,n,o,i;let l;if("node"!==("undefined"!=typeof window?"browser":(null==(i=null==(o=globalThis.process)?void 0:o.release)?void 0:i.name)==="node"?"node":null))throw new n3({message:"Attempted to use child_process module outside of Node.js environment"});let u="node:";try{l=await r(94219)(`${u}child_process`)}catch(e){try{l=(null)(`${u}child_process`)}catch(e){throw new n3({message:"Failed to load child_process module dynamically",cause:e})}}let{spawn:c}=l;return c(e.command,null!=(a=e.args)?a:[],{env:null!=(s=e.env)?s:function(){let e="win32"===globalThis.process.platform?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"],t={};for(let r of e){let e=globalThis.process.env[r];!(void 0===e||e.startsWith("()"))&&(t[r]=e)}return t}(),stdio:["pipe","pipe",null!=(n=e.stderr)?n:"inherit"],shell:!1,signal:t,windowsHide:"win32"===globalThis.process.platform&&"type"in globalThis.process,cwd:e.cwd})}var oi="2024-11-05",ol=[oi,"2024-10-07"],ou=r9.object({name:r9.string(),version:r9.string()}).passthrough(),oc=r9.object({_meta:r9.optional(r9.object({}).passthrough())}).passthrough(),od=r9.object({method:r9.string(),params:r9.optional(oc)}),op=r9.object({method:r9.string(),params:r9.optional(oc)}),om=r9.union([r9.string(),r9.number().int()]),oh=r9.object({jsonrpc:r9.literal("2.0"),id:om}).merge(od).strict(),of=r9.object({jsonrpc:r9.literal("2.0"),id:om,result:oc}).strict(),og=r9.object({jsonrpc:r9.literal("2.0"),id:om,error:r9.object({code:r9.number().int(),message:r9.string(),data:r9.optional(r9.unknown())})}).strict(),oy=r9.object({jsonrpc:r9.literal("2.0")}).merge(op).strict(),ov=r9.union([oh,oy,of,og]),o_=r9.object({experimental:r9.optional(r9.object({}).passthrough()),logging:r9.optional(r9.object({}).passthrough()),prompts:r9.optional(r9.object({listChanged:r9.optional(r9.boolean())}).passthrough()),resources:r9.optional(r9.object({subscribe:r9.optional(r9.boolean()),listChanged:r9.optional(r9.boolean())}).passthrough()),tools:r9.optional(r9.object({listChanged:r9.optional(r9.boolean())}).passthrough())}).passthrough(),ob=oc.extend({protocolVersion:r9.string(),capabilities:o_,serverInfo:ou,instructions:r9.optional(r9.string())}),ow=oc.extend({nextCursor:r9.optional(r9.string())}),ox=r9.object({name:r9.string(),description:r9.optional(r9.string()),inputSchema:r9.object({type:r9.literal("object"),properties:r9.optional(r9.object({}).passthrough())}).passthrough()}).passthrough(),ok=ow.extend({tools:r9.array(ox)}),oT=r9.object({type:r9.literal("text"),text:r9.string()}).passthrough(),oS=r9.object({type:r9.literal("image"),data:r9.string().base64(),mimeType:r9.string()}).passthrough(),oI=r9.object({uri:r9.string(),mimeType:r9.optional(r9.string())}).passthrough(),oE=oI.extend({text:r9.string()}),oj=oI.extend({blob:r9.string().base64()}),oA=r9.object({type:r9.literal("resource"),resource:r9.union([oE,oj])}).passthrough(),oC=oc.extend({content:r9.array(r9.union([oT,oS,oA])),isError:r9.boolean().default(!1).optional()}).or(oc.extend({toolResult:r9.unknown()})),oN=class{constructor(e){this.abortController=new AbortController,this.readBuffer=new oO,this.serverParams=e}async start(){if(this.process)throw new n3({message:"StdioClientTransport already started."});return new Promise(async(e,t)=>{var r,a,s,n;try{let n=await oo(this.serverParams,this.abortController.signal);this.process=n,this.process.on("error",e=>{var r,a;if("AbortError"===e.name){null==(r=this.onClose)||r.call(this);return}t(e),null==(a=this.onError)||a.call(this,e)}),this.process.on("spawn",()=>{e()}),this.process.on("close",e=>{var t;this.process=void 0,null==(t=this.onClose)||t.call(this)}),null==(r=this.process.stdin)||r.on("error",e=>{var t;null==(t=this.onError)||t.call(this,e)}),null==(a=this.process.stdout)||a.on("data",e=>{this.readBuffer.append(e),this.processReadBuffer()}),null==(s=this.process.stdout)||s.on("error",e=>{var t;null==(t=this.onError)||t.call(this,e)})}catch(e){t(e),null==(n=this.onError)||n.call(this,e)}})}processReadBuffer(){for(var e,t;;)try{let t=this.readBuffer.readMessage();if(null===t)break;null==(e=this.onMessage)||e.call(this,t)}catch(e){null==(t=this.onError)||t.call(this,e)}}async close(){this.abortController.abort(),this.process=void 0,this.readBuffer.clear()}send(e){return new Promise(t=>{var r;if(!(null==(r=this.process)?void 0:r.stdin))throw new n3({message:"StdioClientTransport not connected"});let a=JSON.stringify(e)+"\n";this.process.stdin.write(a)?t():this.process.stdin.once("drain",t)})}},oO=class{append(e){this.buffer=this.buffer?Buffer.concat([this.buffer,e]):e}readMessage(){var e;if(!this.buffer)return null;let t=this.buffer.indexOf("\n");if(-1===t)return null;let r=this.buffer.toString("utf8",0,t);return this.buffer=this.buffer.subarray(t+1),e=r,ov.parse(JSON.parse(e))}clear(){this.buffer=void 0}},oR=class{constructor({url:e}){this.connected=!1,this.url=new URL(e)}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var r,a,s;try{let s=await fetch(this.url.href,{headers:{Accept:"text/event-stream"},signal:null==(r=this.abortController)?void 0:r.signal});if(!s.ok||!s.body){let e=new n3({message:`MCP SSE Transport Error: ${s.status} ${s.statusText}`});return null==(a=this.onError)||a.call(this,e),t(e)}let n=s.body.pipeThrough(new TextDecoderStream).pipeThrough(new EventSourceParserStream).getReader(),o=async()=>{var r,a,s;try{for(;;){let{done:t,value:s}=await n.read();if(t){if(this.connected)throw this.connected=!1,new n3({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:o,data:i}=s;if("endpoint"===o){if(this.endpoint=new URL(i,this.url),this.endpoint.origin!==this.url.origin)throw new n3({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if("message"===o)try{let e=ov.parse(JSON.parse(i));null==(r=this.onMessage)||r.call(this,e)}catch(t){let e=new n3({message:"MCP SSE Transport Error: Failed to parse message",cause:t});null==(a=this.onError)||a.call(this,e)}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(s=this.onError)||s.call(this,e),t(e)}};this.sseConnection={close:()=>n.cancel()},o()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(s=this.onError)||s.call(this,e),t(e)}})()})}async close(){var e,t,r;this.connected=!1,null==(e=this.sseConnection)||e.close(),null==(t=this.abortController)||t.abort(),null==(r=this.onClose)||r.call(this)}async send(e){var t,r,a;if(!this.endpoint||!this.connected)throw new n3({message:"MCP SSE Transport Error: Not connected"});try{let a=new Headers;a.set("Content-Type","application/json");let s={method:"POST",headers:a,body:JSON.stringify(e),signal:null==(t=this.abortController)?void 0:t.signal},n=await fetch(this.endpoint,s);if(!n.ok){let e=await n.text().catch(()=>null),t=new n3({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${n.status}): ${e}`});null==(r=this.onError)||r.call(this,t);return}}catch(e){null==(a=this.onError)||a.call(this,e);return}}};function oP(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,s){s.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function oM(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&oq(null==(r=e.data)?void 0:r.chunk,t);return}oq(e,t)}})).pipeThrough(oP(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(sl("text",e))}}))}function o$(e,t){return oM(e,t).pipeThrough(new TextEncoderStream)}function oZ(e,t){var r;let a=oM(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),s=null==t?void 0:t.data,n=null==t?void 0:t.init;return new Response(s?n7(s.stream,a):a,{status:null!=(r=null==n?void 0:n.status)?r:200,statusText:null==n?void 0:n.statusText,headers:sf(null==n?void 0:n.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function oD(e,t){t.dataStream.merge(oM(e,t.callbacks))}function oq(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function oF(e,t){var r;let a;let s=(a=!0,e=>(a&&(e=e.trimStart())&&(a=!1),e));return(r=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{let{value:t,done:a}=await r.next();a?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(s(e.delta))}})).pipeThrough(oP(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(sl("text",e))}}))}function oL(e,t){return oF(e,t).pipeThrough(new TextEncoderStream)}function oU(e,t={}){var r;let{init:a,data:s,callbacks:n}=t,o=oF(e,n).pipeThrough(new TextEncoderStream);return new Response(s?n7(s.stream,o):o,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:sf(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function oV(e,t){t.dataStream.merge(oF(e,t.callbacks))}sh({},{mergeIntoDataStream:()=>oD,toDataStream:()=>o$,toDataStreamResponse:()=>oZ}),sh({},{mergeIntoDataStream:()=>oV,toDataStream:()=>oL,toDataStreamResponse:()=>oU});let oB=30;async function oz(e){try{if(!process.env.OPENAI_API_KEY)return new Response(JSON.stringify({error:"OpenAI API key is not configured. Please set the OPENAI_API_KEY environment variable."}),{status:500,headers:{"Content-Type":"application/json"}});let{messages:t}=await e.json(),r=t.some(e=>"system"===e.role)?t:[{role:"system",content:"You are a helpful AI financial assistant called FinAI. Provide accurate, educational information about investing, financial planning, and market trends. Keep responses concise and focused on financial topics. Do not provide specific investment advice or recommendations for individual securities."},...t];return(function({model:e,tools:t,toolChoice:r,system:a,prompt:s,messages:n,maxRetries:o,abortSignal:i,headers:l,maxSteps:u=1,experimental_generateMessageId:c=oe,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_toolCallStreaming:g=!1,toolCallStreaming:y=g,experimental_activeTools:v,experimental_repairToolCall:_,experimental_transform:b,onChunk:w,onError:x,onFinish:k,onStepFinish:T,_internal:{now:S=function(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()},generateId:I=n8,currentDate:E=()=>new Date}={},...j}){var A;return new ot({model:e,telemetry:m,headers:l,settings:j,maxRetries:o,abortSignal:i,system:a,prompt:s,messages:n,tools:t,toolChoice:r,toolCallStreaming:y,transforms:(A=b,void 0===A?[]:Array.isArray(A)?A:[A]),activeTools:v,repairToolCall:_,maxSteps:u,output:d,continueSteps:p,providerOptions:f,onChunk:w,onError:x,onFinish:k,onStepFinish:T,now:S,currentDate:E,generateId:I,generateMessageId:c})})({model:aE("gpt-3.5-turbo"),messages:r,maxTokens:1e3}).toDataStreamResponse()}catch(t){console.error("Error in chat API:",t);let e=t.message?.includes("rate limit")||t.message?.includes("429");return new Response(JSON.stringify({error:e?"Rate limit exceeded. Please try again in a moment.":"Failed to process chat request. Please try again later."}),{status:e?429:500,headers:{"Content-Type":"application/json"}})}}let oJ=new F.AppRouteRouteModule({definition:{kind:L.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/home/user/FINGEN-AI/app/api/chat/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:oK,workUnitAsyncStorage:oW,serverHooks:oH}=oJ;function oY(){return(0,U.patchFetch)({workAsyncStorage:oK,workUnitAsyncStorage:oW})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},94219:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=94219,e.exports=t},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[719],()=>r(25887));module.exports=a})();